
**Karpov.courses сайт + обучающая платформа LMS**


***Функциональные требования***

1. Пользователи могут просматривать свою статистику по прохождению курса, чтобы восхищаться своими результатами 
2. Пользователи могут отправлять обратную связь по просмотренным урокам / заданиям и получать ответ если возникают вопросы или баги
3. Система должна рекомендовать курсы исходя из интересов и опыта пользователей, джун = аналитик данных, мидл = hard аналитика
4. Пользователю должна быть предоставлена возможность участвовать в программе лояльности, постоянным клиентам необходимы скидки, это повысит метрику retention 
5. Пользователю должна быть предоставлена возможность участвовать в реферальной программе, советовать хорошие курсы друзьям и получать за это плюшки в виде скидок, это увеличит метрику продаж 


***Нефункциональные требования***

1. Главная страница сайта по продаже курсов должна быть постоянно доступна, чтобы пользователь не пошел на Яндекс практикум.
2. Ответы в тестах и загруженные файлы ДЗ студентов должны сохраняться в бд после успешной отправки и не удаляться после обновления страницы, чтобы пользователи не тратили время на повторное решение.
3. Минимальное время задержки новой лекции - 5 минут, после недельного ожидания эти минуты не заметны.


***Cайт***

Зачем нужен такой сервис? 

Чтобы продавать крутые курсы

***Первоочередные особенности***

1. Пользователи могут просматривать информацию по курсам и приобретать их (БД каталога курсов)
2. Система должна рекомендовать курсы на основе алгоритмов исходя из интересов пользователей анализируя их действия (БД действий пользователей)

***обучающая платформа LMS***

***Зачем нужен такой сервис?***

Студентам - Просматривать лекции курсов, читать конспекты, отправлять дз на проверку

Проверяющим - проверять ДЗ

***Первоочередные особенности***
1. Студенты могут смотреть лекции, читать конспекты и выполнять тестовые задания.  Данная информация хранится в БД учебного материала. 
2. В БД действий студентов ведется запись результатов прохождения курсов (кол-во баллов, кол-во пройденных тем и тд) и хранится вся справочная информация по студентам.
3. В БД файлов дз студентов хранятся проектные работы
4. Проверяющие ДЗ занимаются проверкой проектов студентов, которые хранятся в БД файлов ДЗ и начисляют баллы, начисление баллов осуществляется в БД действий 
5. Справочная информация и действия проверяющих хранится в БД действий проверяющих 

![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/karpov-high.png)

***МОДУЛЬНЫЙ ПОДХОД К ДИЗАЙНУ***

***Главная страница курса***

Роли: Модератор, клиент, Маркетолог

Модератор редактирует информацию по курсам через сервис редактирования курсов. Информация по курсам хранится в MongoDB, так как документная модель хорошо работает в системах управления контентом.

Клиент просматривает и покупает курсы используя сервис продажи курсов. Действия пользователей записываются в Clickhouse, колоночная БД лучше всего подходят для однотипных записей.
Метаданные пользователей хранятся в Postgres, РУСБД применимы при множестве связей между сущностями. 
После приобретения курса необходимо сразу же направить уведомление на почту клиента, для этого сервис продажи курсов взаимодействует с сервисом отправки уведомлений через очередь. 
RabbitMQ идеально подходит для веб-сервисов с низкими задержками.
Информация обо всех рассылках должна сохраняться на будущее на всякий случай в Redis -  быстрое хранилище пар «ключ‑значение».

Для массовых рассылок специальных предложений отдел маркетинга использует сервис маркетинга. Почты для рассылки берутся из БД Postgres, взаимодействие с сервисом отправки уведомлений осуществляется через очередь. 

***Портал КС***

Роли: Модератор, студент, проверяющий 

Модератор редактирует материал курсов через сервис редактирования контента. Контент хранится в MongoDB, так как документная модель хорошо работает в системах управления контентом.

Студент изучает материал курсов через сервис портала КС для студентов, действия студентов записываются в Clickhouse, колоночная БД лучше всего подходят для однотипных записей.
Метаданные пользователей хранятся в Postgres, РУСБД применимы при множестве связей между сущностями, а также для таких чувствительных данных как баллы за выполненные задания.

Для отправки проектов студенты используют сервис загрузки ДЗ, файлы отправляются через брокер Kafka, так как консьмер - сервис проверки ДЗ должен сам забирать (pull) записи из выбранного топика когда появляются свободные проверяющие.

Для принятия ДЗ проверяющие используют сервис проверки и после назначения проверяющего файл ДЗ попадает в хранилище amazon S3. Действия проверяющих записываются в Clickhouse. При проверке ДЗ проверяющий определяет кол-во баллов, запись ведется в Postgres.


![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/karpovb.png)


**Маркетплейс**

***Зачем нужен такой сервис?***

Чтобы купить/продать товар

3 вида пользователей: покупатели, продавцы, модераторы 

***Первоочередные особенности***

1. Покупатели могут просматривать информацию по товарам (БД товаров), добавлять их в избарнное и приобретать (БД заказов). 
2. Система должна рекомендовать релевантные товары на основе алгоритмов анализируя действия пользователей (БД действий покупателей)
3. У крупного маркетплейса в периоды акций может быть большой наплыв пользователей (покупателей), поэтому можно сразу отметить наличие балансировщика нагрузки
4. Продавцы маркетплейса могут публиковать карточки с товарами, запись таких данных ведется в БД товаров 
5. Вся информаци и действия пользователей продавцов хранится в БД действий продавцов 
6. Для модерации карточек товаров и предотвращения фрода предусмотрен сервис модерации.


![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/market-high.png)


***МОДУЛЬНЫЙ ПОДХОД К ДИЗАЙНУ***

***Маркетплейс***
Роли: Покупатель,  продавец, модераторы, маркетолог

***Покупатель***

1. У крупного маркетплейса в периоды акций может быть большой наплыв пользователей (покупателей), поэтому можно сразу отметить наличие балансировщика нагрузки и несколько серверов.
2. Для просмотра товаров покупатели используют сервис просмотра товаров, для оплаты - сервис оплаты.  Действия пользователей записываются в Clickhouse, колоночная БД лучше всего подходят для однотипных записей. Метаданные пользователей хранятся в Postgres, РУСБД применимы при множестве связей между сущностями. 
3. После оплаты заказ отправляется в сервис отправки товаров через брокер RabbitMQ для обработки заказа и создания трекномера. Сам заказ записывается в Бд Postgres (РУСБД применимы при множестве связей между сущностями). 
4. Также брокер RabbitMQ отправляет информацию о продаже товаров в сервис Инвентарь, который калькулирует остатки и заносит информацию в MongoDB каталог товаров (документная модель хорошо работает в системах управления контентом)
5. После успешного оформления заказа необходимо отправить уведомление клиенту. Сервис отправки товаров взаимодействует с сервисами отправки уведомлений через  брокер RabbitMQ. При высоких нагрузках количество консьюмеров сервисов уведомлений (воркеров), обрабатывающих сообщения можно увеличить.
6. Сервисы отправки уведомлений взаимодействуют с различными хендлерами уведомлений через  брокер RabbitMQ и с сервисом логирования уведомлений, который заносит всю историю уведомлений и рассылок в Redis ( быстрое хранилище пар «ключ‑значение».)

***Продавец***

1. Для публикации своих товаров продавцы используют сервис публикации товаров, который взаимодействует с сервисом инвентарь через брокер RabbitMQ.Действия пользователей записываются в Clickhouse, колоночная БД лучше всего подходят для однотипных записей. 
2. Метаданные пользователей хранятся в Postgres, РУСБД применимы при множестве связей между сущностями. 

***Модераторы***
Для модерации карточек товаров и предотвращения фрода со стороны покупателей предусмотрен сервисы модерации, у которых есть доступы к бд метаданных, действий пользователей и каталогу.

***Маркетолог***
Для массовых рассылок специальных предложений отдел маркетинга использует сервис маркетинга. Почты для рассылки берутся из БД Postgres, а выборка для рассылок формируется на основе действий пользователей и товаров попадающих под акции. взаимодействие с сервисом отправки уведомлений осуществляется через брокер RabbitMQ. 

***RabbitMQ***- отлично подходит для подобных фоновых задач, а также для коммуникации внутри приложений с сложной логикой.

![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/marketb.png)




**Дизайн сайта магазина премиальных предметов в онлайн-игре**

***Зачем нужен такой сервис?***

Чтобы купить/продать предметы

2 вида пользователей: покупатели и продавцы

***Первоочередные особенности?***

1. Покупатель и продавец может просматривать каталог предметов и фильтроваться по атрибутам и недавним позициям 
2. Продавец может выставлять свои предметы на продажу, а покупатель покупать
3. Покупателям и продавьцам доступна возможность чата между собой, пользователи могут обращаться либо к истории сообщений, либо вести беседы,  при беседе двух пользователей необходимо быстро доставлять их сообщения друг другу;


***Postgres*** - для хранение метаданных про пользователей и баланса монет у покупателей и продавцов тк данные чувствительны
<br/>
РУСБД применимы при множестве связей между сущностями. 

***MongoDB*** -  для хранения атрибутов предметов (каталог).
<br/>
Документная модель хорошо работает в системах управления контентом.

***Clichouse*** - для хранение истории действий покупателей и продавцов, а также всю историю сообщений покупателей и продавцов
<br/>
Колоночная БД лучше всего подходят для однотипных записей.

***Redis*** -  для хранения статусов пользователей,  недавних публикаций предметов и недавних сообщений между продавьцами и покупателями.
<br/>
Быстрое хранилище пар «ключ‑значение».

![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/shopdb.png)




**Соц сеть заливки фото/видео**


![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/scale.png)

***Web Page***

1. Приходит много пользователей, и их запросы проходят через loadbalancer. Также существует его реплика, которая находится в режиме ожидания и будет работать в случае поломки основного балансировщика;
2. У веб-страницы есть много разных инстансов, которые должны отрабатывать запросы за адекватное время. Если один из них перестаёт отвечать, то опционально мы передаём информацию в автоскейлер, который создаст новый инстанс;
3. Балансировщик нагрузки выбирает наиболее свободный инстанс, которому передать входящий запрос;

***New Post Service***

1. Дополнительные балансировщики нагрузки и их копии для сервисов. У каждого сервиса также есть инстансы;
2. У сервиса New Post Service есть балансировщики, которые распределяют  передаваемый трафик для хранилищ
3. Метаданные пользователей хранятся в Postgres, РУСБД применимы при множестве связей между сущностями.
4. Посты пользователей записываются в Clickhouse, колоночная БД лучше всего подходят для однотипных записей, можно рассмотреть сценарий с «программными» JOIN-ами, когда все метаданные постов хранятся в колоночной БД, тк их проще масштабировать в отличии от РУСБД.
5. У баз данных есть реплики, которые помогут сервису продолжать работу в случае неполадок с оригинальной базой данных.
6. Для общения и интеграции между различными сервисами используется RabbitMQ, данный брокер идеально подходит для веб-сервисов с низкими задержками благодаря делегированию нагрузки множеству воркеров;

***Logging Service***

1. Логи заливки постов и сессии пользователей записываются в Redis -быстрое хранилище пар «ключ‑значение»
2. У Redis есть копия, которая хранится на жестком диске оффлайн на случай отказа основного инстанса

***Image Upload Service***

1. Сервис загрузки фотографий взаимодействует с распределенным хранилищем HDFS через балансировщик. HDFS поддерживает хранение разнообразных данных — структурированных (таблицы), полуструктурированных (JSON, XML) и неструктурированных (видео и изображения).
2. HDFS разбивает файлы на небольшие блоки и хранит их на разных узлах в кластере серверов по патрициям 

***Video Upload Service***

1. Сервис загрузки видео взаимодействует с сервисом обработчиком через RabbitMQ, брокер отлично подходит для фоновых и долгоиграющих задач вроде конвертации видео.

***Processing Service***

1. Сервис обработчик видео  взаимодействует с распределенным хранилищем HDFS через балансировщик. 
2. HDFS разбивает файлы на небольшие блоки и хранит их на разных узлах в кластере серверов по патрициям 


***Повышение отзывчивости***

![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/index.png)


***Home Page***

1. Между пользователем и сервером кэш, чтобы каждый раз заново не запрашивать страницы.

***Home View Servie***

1. Когда запрашиваем профили, можем обращаться к кэшу, где хранятся недавние профили. 
2. Если есть необходимость обратиться к исходной базе, можем ее проиндексировать по ID юзера.
3. Метаданные пользователей хранятся в Postgres, РУСБД применимы при множестве связей между сущностями.


***Logging Servie***

1. Логи заливки постов и сессии пользователей записываются в Redis -быстрое хранилище пар «ключ‑значение».
2.  Redis и так довольно быстрое хранилище, поэтому кэш не сильно поможет  и операций на запись значительно больше, чем операций на чтение, в таком случае не стоит индексировать таблицу

***Post View Service***

1. Когда запрашиваем профили, можем обращаться к кэшу, где хранятся недавние посты. 
2. Если есть необходимость обратиться к исходной базе, можем ее проиндексировать по ID постов.
3. ID В качестве идентификатора поста может выступать 64-битное число, которое содержит в себе: зарезервированный бит, временную метку с момента создания сессии и тд.
4. Посты пользователей записываются в Clickhouse, колоночная БД лучше всего подходят для однотипных записей, можно рассмотреть сценарий с «программными» JOIN-ами, когда все метаданные постов хранятся в колоночной БД, тк их проще масштабировать в отличии от РУСБД.
5.  Для часто запрашиваемых медиа файлов вроде изображений, и видео используются инстансы CDN (распределённые хранилища данных, которые используются в крупных системах, покрывающих различные регионы и даже весь мир.)
6. Все медиафайлы хранятся в HDFS  - поддерживает хранение разнообразных данных — структурированных (таблицы), полуструктурированных (JSON, XML) и неструктурированных (видео и изображения).

***Подсистемы поиска в приложении доставки еды***


![Image alt](https://github.com/dmatwe/projects/blob/main/System_design/проекты/png/search.png)


***Editor UI, Edit Service***

1. Редакторы заносят места для бронирования ресторанов и просмотра меню используя Edit Service.
2. MongoDB  используется для хранения таких атрибутов (наименование ресторана, адрес, описание, списки блюд. Документная модель хорошо работает в системах управления контентом.
3. Данные хранятся по шардам, секционирование повышает масштабируемость и производительность системы.

***Search UI, Content Search Service***

1. Приходит много пользователей, и их запросы проходят через loadbalancer. Также существует его реплика, которая находится в режиме ожидания и будет работать в случае поломки основного балансировщика;
2. Балансировщик нагрузки выбирает наиболее свободный и инстанс, которому передать входящий запрос;
3. Взаимодействие с другими сервисами происходит через балансировщик нагрузки

***Redis Cache Restaurants Menu***

1. В данной БД хранится наиболее релевантная информация по ресторанам и меню для пользователя
2. Если в кеше ничего нет, запрос перенапраавляется в главную БД MongoBD

***Logging Service***

1. Логи запросов пользователей записываются в Redis -быстрое хранилище пар «ключ‑значение»
2. У Redis есть копия, которая хранится на жестком диске оффлайн на случай отказа основного инстанса

***Indexing Geo Service***

1. Обращается к MongoD (для получения координат)/ Redis Logs (для получения статистики) и строит GeoHash / QuadTree в Geo Index 

***Indexing Auto Service***

1. Обращается к MongoD (для получения наименований блюд / ресторанов) / Redis Logs (для получения статистики) и строит и строит префиксное дерево 
2. Префиксное дерево хранится в отдельной БД Tree DB, а топовые результаты в кеше

***Geo search Servie***

1. Geo search Servie обращается к Geo Index для поиска ближайших ресторанов

***Autocomplete Servie***

1. Autocomplete Service обращается к кешу/БД префиксного дерева для автодополнения запроса

