**Общие сведения** 

ООО “Рога и копыта” специализируется на ресторанном бизнесе. Компания занимает лидирующие позиции на рынке ресторанов быстрого питания. В рамках компании сложилась инициативная команда, которая смотрит в будущее и хочет запустить полностью автоматизированный ресторан под названием  "Робот и точка".

Система должна включать в себя:

Приложение для заказа блюд

Приложение для оркестрации работы роботов

Приложение для учета и заказа полуфабрикатов

Учет сроков хранения

Учет продаж

Приложения должны иметь интерфейс пользователя - для заказа или настройки 


**Основная цель проекта**

Необходимо оптимизировать трудозатраты для увеличения прибыли с помощью новой системы и роботов:
1. Запуск полностью автоматизированного ресторана под названием "Робот и точка" с целью увеличения прибыли и оптимизации трудозатрат.
2. Создание системы, включающей в себя приложения для заказа блюд, оркестрации работы роботов, учета и заказа полуфабрикатов, учета сроков хранения и учета продаж.

**Метрики, критерии успешности**

Минимальный: Скорость обслуживания не должна уменьшиться

Максимальный: Скорость обслуживания должна вырасти на 30%

Минимальный: Операционные затраты не должны вырасти как минимум

Максимальный: Операционные затраты должны сократиться на 30%


**Процессы, которые необходимо оптимизировать**
1. Оркестрация работы роботов для снижения времени приготовления блюд.
2. Учет и заказ полуфабрикатов для сокращения времени выдачи заказов клиентам.
3. Разработка эффективного приложения для заказа блюд для улучшения скорости обслуживания клиентов.
4. Внедрение системы учета сроков хранения для оптимизации инвентаризации и снижения операционных затрат.
5. Создание пользовательского интерфейса приложений, удовлетворяющего требованиям заказа и настройки для клиентов.

Также необходимо проработать оптимизацию времени приготовления блюд, а также улучшение операционных процессов для сокращения затрат.

**Заинтересованные лица**
| Список стейкхолдеров                             |
| ------------------------------------------------ |
| Генеральный директор                             |
| Главный бухгалтер                                |
| Директор по ИТ                                   |
| Директор по маркетингу                           |
| Директор по продажам                             |
| Операционный директор                            |
| Финансовый директор                              |
| Продакт менеджер продукта “Робот и точка”        |
| Технолог роботизированного пищевого производства |


**Требования бизнеса**

| № | Бизнес требования                                                     | Источник |
| - | --------------------------------------------------------------------- | -------- |
| 1 | Оптимизировать трудозатраты для увеличения прибыли                    | Генеральный Директор |
| 2 | Скорость обслуживания не должна уменьшиться                           | Генеральный Директор |
| 3 | Скорость обслуживания должна вырасти на 30%                           | Генеральный Директор |
| 4 | Операционные затраты не должны вырасти                                | Генеральный Директор |
| 5 | Операционные затраты должны сократиться на 30%                        | Генеральный Директор |
| 6 | Оптимизировать время выдачи заказов клиентам                          | Продакт менеджер |
| 7 | Оптимизировать время приготовления блюд                               | Продакт менеджер |
| 8 | Система должна быть готова к выпуску в течение 1 года (MVP продукта). | Продакт менеджер |

**Нефункциональное требования**

| №  | Требование                                                                                                                             | Источник             |
| -- | -------------------------------------------------------------------------------------------------------------------------------------- | -------------------- |
| 1  | Интеграция с платежной системой для осуществления оплаты через терминал                                                                | технолог             |
| 2  | Интеграция с системой заказа продуктов                                                                                                 | технолог             |
| 3  | Система должна поддерживать работу 24/7                                                                                                | Продакт менеджер     |
| 4  | Система должна быть способной обрабатывать 5000 заказов в день                                                                         | Продакт менеджер     |
| 5  | Система должна обеспечивать интеграцию с сервисами доставки для отправки заказов клиентам                                              | Продакт менеджер     |
| 6  | Система должна поддерживать масштабирование до 100 ресторанов                                                                          | Продакт менеджер     |
| 7  | Система должна использовать облачные сервисы, не требующие интеграции с текущей инфраструктурой                                        | Технический директор |
| 8  | Система должна поддерживать PC с операционной системой Windows                                                                         | Технический директор |
| 9  | Мобильное приложение должно быть доступно на IOS и Android                                                                             | Технический директор |
| 10 | Система по хранению продуктов должна быть написана с нуля                                                                              | Технический директор |
| 11 | Необходима база данных для хранения информации о продуктах                                                                             | Технический директор |
| 12 | Downtime системы не должен превышать 10 минут                                                                                          | Технический директор |
| 13 | Система должна иметь систему оповещений о сбоях, например, Apex                                                                        | Технический директор |
| 14 | Необходим стандартный мониторинг системы, например, Grafana.                                                                           | Технический директор |
| 15 | Система должна выдерживать 5000 заказов в день и одновременно 100 сессий.<br>При масштабировании до 10000 сессий одновременно.         | Технический директор |
| 16 | Система должна быть доступна на русском языке                                                                                          | Технический директор |
| 17 | Для мобильного приложения должна быть поддержка СБП<br>Для терминала должна быть поддержка обычной оффлайн кассы приема кредитных карт | Технический директор |


**Пользовательские требования**

| № | Требование                                                                                      | Источник             |
| - | ----------------------------------------------------------------------------------------------- | -------------------- |
| 1 | Интерфейс для мониторинга и управления роботами                                                 | технолог             |
| 2 | Интерфейс для оформление заказов и оплаты в мобильном приложении клиентов                       | технолог             |
| 3 | Интерфейс для редактирования меню блюд для администратора ресторана                             | технолог             |
| 4 | Интерфейс для управления складскими процессами сотрудникам бекофиса                             | технолог             |
| 5 | Сотрудники бизнес-отдела должны иметь доступ к отчетам.                                         | Технический директор |
| 6 | Клиенты должны иметь возможность делать заказы через приложение                                 | Технический директор |
| 7 | Сотрудник по технологическим картам блюд должен иметь доступ к интерфейсу для работы с картами. | Технический директор |
| 8 | Сотрудники первой линии поддержки должны иметь доступ к системе для решения инцидентов системы  | Технический директор |
| 9 | Технолог должен получать уведомления о сбоях                                                    | Технический директор |

**Системные требования**

| № | Требование                                                                    | Источник         |
| - | ----------------------------------------------------------------------------- | ---------------- |
| 1 | АРМ (автоматизированное рабочее место) менеджера для управления рестораном    | технолог         |
| 2 | Необхоимо разработать web приложение для оформления заказов                   | Продакт менеджер |
| 3 | Необхоимо разработать мобильное приложение для оформления заказов             | Продакт менеджер |
| 4 | Необхоимо разработать приложение для оффлайн терминала для оформления заказов | Продакт менеджер |

**Функциональные требования**

| № | Требование                                                                                      | Источник             |
| - | ----------------------------------------------------------------------------------------------- | -------------------- |
| 1 | Программная поддержка для работы с роботами на точках с оборудованием (тостер, гриль, заправка) | технолог             |
| 2 | Возможность мониторинга и управления роботами                                                   | технолог             |
| 3 | Возможность мониторинга остатков                                                                | технолог             |
| 4 | АРМ (автоматизированное рабочее место) менеджера для управления рестораном                      | технолог             |
| 5 | Необхоимо разработать web приложение для оформления заказов                                     | Продакт менеджер     |
| 6 | Необхоимо разработать мобильное приложение для оформления заказов                               | Продакт менеджер     |
| 7 | Необхоимо разработать приложение для оффлайн терминала для оформления заказов                   | Продакт менеджер     |
| 8 | Система должна формировать отчет по количеству заказов.                                         | Технический директор |


 - [Miro (полная версия)](https://miro.com/welcomeonboard/TW0xZXBtOEEwaVpBNWJIcnZEcW1qYkJuNWN1RFJwcG0xd2FzZzVBa2VDTDU3bmhNdzRRN2FnZDRiU2FvTkRLSnwzNDU4NzY0NTIzNjk5NzU4NDczfDI=?share_link_id=699446562339)

**Карта пользовательских историй** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/Карта%20пользовательских%20историй%20.png)

**US клиент** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/Acceptance%20Criteria/US.png)

**US Сотрудник производства** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/US%20Сотрудник%20производства.png)


**US Менеджер зала** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/US%20Менеджер%20зала.png)

**US Менеджер ассортимента** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/US%20Менеджер%20ассортимента.png)


**Defenition of Done** 

- Соответствует определенным ожиданиям стейкхолдеров
- Успешно завершено тестирование в соответствии с критериями приемки
- Владелец продукта (Product Owner) принял задачу
- Регрессионные тесты проходят
- Выполнены нефункциональные требования
- Обновлена пользовательская документация


**BPMN бизнес-процесса оформление заказа**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/BPMN/Робот%20и%20точка%20оформление%20заказа.png)

**BPMN бизнес-процесса регистрация клиента**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/BPMN/Робот%20и%20точка%20регистрация%20клиента.png)

**Описание кейса**

Человек приходит к нам в ресторан и обращается к информационному меню. На
стойке он может выбрать категорию блюд (бургеры, напитки, прочее), затем конкретное
блюдо, добавить его в корзину. Когда клиент выбрал все что ему нужно и готов
оплатить заказ, то ему нужно показать полный список заказанного.
При этом, если у клиента есть бургер, то нужно дополнительно предложить к заказу
картошку и пирожок.
При сумме заказа более 1500 рублей или наличии специального комбо, мы даем в
подарок фирменный стакан “робот и точка”. При этом, если заказ происходит в будние
дни с 10 до 16, то сделать скидку, т.к. это будет считаться бизнес-ланчем.
Клиент указывает где он будет есть, с собой или в зале.
Перед оплатой, важно спросить является ли клиент участником нашей системы
лояльности. Если нет, то предложить зарегистрироваться. Если да, то предложить
начислить или списать баллы.
После этого, подсчитать итоговую сумму с учетом бонусов, если они были
использованы и перейти к процессу оплаты.


**Модель предметной области**
**диаграмме-классов**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/UML/uml_er.png)

**Диаграмма состояний**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/UML/uml_s.png)


**Модель C4: компонентная архитектура приложения**

Микросервисная архитектура является эффективным подходом для разработки приложений, которые должны масштабироваться и быть гибкими в изменении. В случае инфраструктуры для автоматизации бизнес-процессов ресторана “Робот И Точка”, микросервисная архитектура может предоставить следующие преимущества:

Гибкость: Микросервисы могут быть разработаны и развернуты независимо друг от друга, что позволяет быстро вносить изменения в приложение без необходимости перезапуска всего приложения.

Масштабируемость: Микросервисы могут быть масштабированы отдельно друг от друга, что позволяет легко управлять нагрузкой на приложение и обеспечивать высокую доступность.

Устойчивость: Если один из микросервисов не работает, остальные микросервисы могут продолжать работу, что обеспечивает устойчивость приложения в целом.

Легкость разработки: Разработчики могут работать над отдельными микросервисами, что упрощает процесс разработки и тестирования.

Легкость внедрения новых функций: Новые функции могут быть добавлены в виде новых микросервисов, что позволяет быстро внедрять новые возможности в приложение.


![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/Модель%20C4/C4.png)

**Модель базы данных** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/БД%20нагрузка/robot.png)

| Сущность         | clients                          |
| ---------------- | -------------------------------- |
| Описание         | Справочник клиентов              |
| Атрибут сущности | Описание атрибута                |
| client_id        | Идентификатор клиента<br>        |
| FIO              | ФИО                              |
| tel              | Телефон                          |
| email            | Почта                            |
| start_dt         | Дата регистрации                 |
| Сущность         | orders                           |
| Описание         | Cущность заказов клиентов        |
| Атрибут сущности | Описание атрибута                |
| order_id         | Идентификатор заказа             |
| client_id        | Идентификатор клиента<br>        |
| order_dt         | Время заказа (смены статуса)     |
| status           | Статус заказа                    |
| type             | Способ получения заказа          |
| Сущность         | sessions                         |
| Описание         | Cущность сессий клиентов         |
| Атрибут сущности | Описание атрибута                |
| session_id       | Идентификатор сессии             |
| client_id        | Идентификатор клиента<br>        |
| auth_status      | Статус авторизации               |
| auth_type        | Способ авторизации               |
| purchase_flg     | Флаг покупки                     |
| session_dt       | Дата сессии                      |
| Сущность         | orders_items                     |
| Описание         | Cущность позиций заказов         |
| Атрибут сущности | Описание атрибута                |
| order_id         | Идентификатор заказа             |
| item_id          | Идентификатор товара             |
| item_count       | Кол-во товара одной позиции      |
| price            | Цена                             |
| discount         | Размер скидки                    |
| Сущность         | orders_payment                   |
| Описание         | Cущность оплаты заказов клиентов |
| Атрибут сущности | Описание атрибута                |
| order_id         | Идентификатор заказа             |
| price            | Сумма заказа                     |
| written_off      | Списанные баллы                  |
| awarded          | Начисленные баллы                |
| payment_dt       | Дата оплаты                      |
| payment_status   | Статус оплаты                    |
| payment_type     | Тип оплаты                       |
| Сущность         | clients_loaylty                  |
| Описание         | Cущность кол-во баллов клиентов  |
| Атрибут сущности | Описание атрибута                |
| client_id        | Идентификатор клиента            |
| point_count      | Кол-во баллов                    |
| count_dt         | Дата подсчета                    |
| Сущность         | clients_loaylty                  |
| Описание         | Cущность кол-во баллов клиентов  |
| Атрибут сущности | Описание атрибута                |
| Сущность         | dishs                            |
| Описание         | Cущность блюд из меню            |
| Атрибут сущности | Описание атрибута                |
| dish_id          | Идентификатор блюда              |
| category_id      | Идентификатор категории          |
| name             | Наименование блюда               |
| price            | Цена блюда                       |
| Сущность         | dishs_recipe                     |
| Описание         | Cущность рецептов блюда          |
| Атрибут сущности | Описание атрибута                |
| dish_id          | Идентификатор блюда              |
| ingredient_id    | Идентификатор ингредиента        |
| ingredient_count | Кол-во ингредиента               |
| position         | Позиция ингредиента              |
| Сущность         | categorys                        |
| Описание         | Cущность категорий меню          |
| Атрибут сущности | Описание атрибута                |
| category_id      | Идентификатор категории          |
| name             | Наименование категории           |
| Сущность         | ingredients                      |
| Описание         | Cущность категорий меню          |
| Атрибут сущности | Описание атрибута                |
| ingredient_id    | Идентификатор ингредиента        |
| name             | Наименование ингредиента         |



**Требования к производительности**

| Требования к производительности    | 50-й процентиль | 90-й процентиль | 99-й процентиль |
| ---------------------------------- | --------------- | --------------- | --------------- |
| Макс. Транзакций в секунду на базу | 500             | 1000            | 2000            |
| Макс. Сокет соединений на базу     | 56              | 128             | 256             |
| Операции чтения, %                 | 55              | 60              | 30              |
| Операции записи, %                 | 45              | 40              | 70              |
| Случайные операции, %              | 70              | 80              | 90              |
| Последовательные операции, %       | 30              | 20              | 10              |
| Мин. Задержка репликации, секунд   | 2               | 3               | 5               |



**Первичная нагрузка**

| Запросы                                                  | Частота      | Сложность | Типы дисков | Партицирование | Таблица                                   |
| -------------------------------------------------------- | ------------ | --------- | ----------- | -------------- | ----------------------------------------- |
| Селект на просмотр / поиск блюд                          | часто        | 1         | NVMe        | Partition_01   | dishs                                     |
| Селект на просмотр / поиск клиентов                      | часто        | 1         | NVMe        | Partition_01   | clients                                   |
| Селект на просмотр баллов клиентов                       | часто        | 1         | NVMe        | Partition_01   | clients_loaylty                           |
| Селект на просмотр / поиск заказов                       | часто        | 1         | NVMe        | Partition_01   | orders                                    |
| Селект на просмотр состава заказов                       | часто        | 1         | NVMe        | Partition_01   | orders_dishs                              |
| Селект на просмотр оплаты заказов                        | часто        | 1         | NVMe        | Partition_01   | orders_payment                            |
| Селект на просмотр сессий клиентов                       | часто        | 1         | NVMe        | Partition_01   | sessions                                  |
| Селект на просмотр состава блюд                          | часто        | 1         | NVMe        | Partition_01   | dishs_recipe                              |
| Селект на просмотр ингредиентов                          | часто        | 1         | NVMe        | Partition_01   | ingredients                               |
| Добавление клиента в справочник                          | часто        | 2         | SSD         | Partition_02   | clients                                   |
| Добавление блюда в меню                                  | часто        | 2         | SSD         | Partition_02   | dishs                                     |
| Редактирование состава блюд                              | часто        | 2         | SSD         | Partition_02   | dishs_recipe                              |
| Пересчет баллов клиента                                  | часто        | 2         | SSD         | Partition_02   | clients_loaylty                           |
| Редактировать статус заказа                              | часто        | 2         | SSD         | Partition_02   | orders                                    |
| Среднее время жизненного цикла заказа в разрезе статусов | часто        | 2         | SSD         | Partition_02   | orders                                    |
| Отчет за квартал по категориям                           | периодически | 3         | HDD         | Partition_03   | orders + orders_dishs + dishs + categorys |
| Отчет за квартал по блюдам                               | периодически | 3         | HDD         | Partition_03   | orders + orders_dishs + dishs             |
| Отчет за квартал по программе лояльности                 | периодически | 3         | HDD         | Partition_03   | clients_loaylty                           |
| Отчет за квартал по всем заказам в разрезе статусов      | периодически | 3         | HDD         | Partition_03   | orders                                    |

Преобладать будут простые частые запросы на поиск, и создание (т. е. OLTP система).
Однако в рамках приложения необходимо будет предоставление аналитики, статистики как в целом, так и по конкретным точкам и позициям. (т. е. сложные запросы также будут, но будут выполняться раз в неделю или раз в месяц).


**Нагрузка на cистему**

Исходя из бизнес требований полученных на интервью можно прогнозировать нагрузку 

1 Год:


1 ресторан
5000 заказов в день


| Общее количество пользователей           | 2 000 | человек                                              |
| ---------------------------------------- | ----- | ---------------------------------------------------- |
| Целевое количество пользователей системы | 1 800 | человек                                              |
| Пользователей в пике                     | 782   | человек                                              |
| Частота обращений пользователей в базу   | 5     | раз в минуту                                         |
| Всего обращений в базу в секунду         | 65    | транзакций в секунду                                 |
| Работающий клиент TCP                    | 15%   | одновременно работающих из всего числа пользователей |
| что дает                                 | 117   | постоянно действующих TCP сессий                     |
| Макс. Сокет соединений на базу           | 128   | сессий в секунду                                     |
| Макс. Транзакций в секунду на базу       | 1 000 | транзакций в секунду                                 |
| Выводы                                   |       |                                                      |
| Серверов баз данных                      | 0,92  | Из расчета сокетов TCP сессий                        |
| Серверов баз данных                      | 0,07  | Из расчета - транзакция в секунду                    |


3 года:

50 ресторанов
250000 заказов в день


| Общее количество пользователей           | 100 000 | человек                                              |
| ---------------------------------------- | ------- | ---------------------------------------------------- |
| Целевое количество пользователей системы | 90 000  | человек                                              |
| Пользователей в пике                     | 832     | человек                                              |
| Частота обращений пользователей в базу   | 5       | раз в минуту                                         |
| Всего обращений в базу в секунду         | 69      | транзакций в секунду                                 |
| Работающий клиент TCP                    | 15%     | одновременно работающих из всего числа пользователей |
| что дает                                 | 125     | постоянно действующих TCP сессий                     |
| Макс. Сокет соединений на базу           | 128     | сессий в секунду                                     |
| Макс. Транзакций в секунду на базу       | 1 000   | транзакций в секунду                                 |
| Выводы                                   |         |                                                      |
| Серверов баз данных                      | 0,98    | Из расчета сокетов TCP сессий                        |
| Серверов баз данных                      | 0,07    | Из расчета - транзакция в секунду                    |


5 лет:

100 ресторанов
500000 заказов в день


| Общее количество пользователей           | 200 000 | человек                                              |
| ---------------------------------------- | ------- | ---------------------------------------------------- |
| Целевое количество пользователей системы | 180 000 | человек                                              |
| Пользователей в пике                     | 1 412   | человек                                              |
| Частота обращений пользователей в базу   | 5       | раз в минуту                                         |
| Всего обращений в базу в секунду         | 118     | транзакций в секунду                                 |
| Работающий клиент TCP                    | 15%     | одновременно работающих из всего числа пользователей |
| что дает                                 | 212     | постоянно действующих TCP сессий                     |
| Макс. Сокет соединений на базу           | 128     | сессий в секунду                                     |
| Макс. Сокет соединений на базу           | 128     | транзакций в секунду                                 |
| Выводы                                   |         |                                                      |
| Серверов баз данных                      | 1,65    | Из расчета сокетов TCP сессий                        |
| Серверов баз данных                      | 0,92    | Из расчета - транзакция в секунду                    |



**Размер БД**

| Метрики                                        | через  1 год | через 3 года | через 5 лет |
| ---------------------------------------------- | ------------ | ------------ | ----------- |
| Количество пользователей (U)                   | 2000         | 100000       | 200000      |
| Количество записей в день (L)                  | 5000         | 250000       | 500000      |
| Количество дней в году (D)                     | 365          | 365          | 365         |
| Количество лет истории (Y)                     | 1            | 3            | 5           |
| Средний размер записи (S) в Кб                 | 0,23         | 0,23         | 0,23        |
| Усредненный размер индекса на элемент (I) в Кб | 0,0064       | 0,0064       | 0,0064      |
| Количество индексов (A)                        | 4            | 4            | 4           |
| Коэффициент накладных расходов базы (E)        | 1,4          | 1,4          | 1,4         |
| Количество версий (V)                          | 1            | 1            | 1           |
| Размер БД по формуле Гб                        | 1245,60928   | 9342069,63   | 62280464,2  |
| Выбор инстанса БД                              | 1000Гб       | 200000Гб     | 1000000Гб   |


**Выбор архитектуры**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/БД%20нагрузка/с4drawio.png)

Использование базы данных PostgreSQL с репликацией и брокером сообщений Kafka для распределения транзакций будет наиболее эффективным по нескольким причинам.

1. Масштабируемость: PostgreSQL позволяет горизонтальное масштабирование с помощью репликации, что обеспечит возможность распределения нагрузки в зависимости от количества ресторанов и заказов. Это позволит легко расширить базу данных при увеличении объема заказов и ресторанов.

2. Надежность и целостность данных: PostgreSQL обеспечивает высокую надежность и целостность данных благодаря своей транзакционной структуре и возможности использования репликации для обеспечения отказоустойчивости.

3. Гибкость и скорость: Kafka, как брокер сообщений, предоставляет гибкую и быструю систему для распределения транзакций между ресторанами и базой данных. Это обеспечивает эффективное обновление и доступ к данным в реальном времени.

4. Масштабируемость Kafka: Kafka также обладает возможностью масштабироваться и использоваться в качестве потоковой платформы для обработки большого объема данных, что подходит для обработки множества заказов в реальном времени.

5. Производительность и оптимизация: В сочетании PostgreSql и Kafka можно достичь высокой производительности и оптимизации запросов за счет эффективного распределения данных и отправки сообщений между различными компонентами системы.

Таким образом, использование PostgreSQL с репликацией и брокером сообщений Kafka обеспечит необходимую масштабируемость, надежность, гибкость и производительность для обработки огромного объема транзакций, обусловленного возрастающим количеством ресторанов и заказов.


