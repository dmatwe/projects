**Тема проекта «Проектирование инфраструктуры для автоматизации бизнес-процессов ресторана “Робот И Точка”»**


**Оглавление**

[1. Общие сведения](#Общие_сведения)

[2. Основная цель проекта](#Основная_цель_проекта)

[3. Метрики, критерии успешности](#Метрики)

[4. Процессы, которые необходимо оптимизироват](#Процессы)

[5. Заинтересованные лица](#Заинтересованные)

[6. Требования бизнеса](#Требования_бизнеса)

[7. Требования бизнеса](#Требования_бизнеса)

[8. Нефункциональные требования](#Нефункциональные)

[9. Пользовательские требования](#Пользовательские)

[10. Системные требования](#Системные)

[11. Функциональные требования](#Функциональные)

[12. Карта пользовательских историй](#Карта)

[13. Defenition of Ready](#dor)

[14. Defenition of Done](#dod)

[15. BPMN бизнес-процессов](#BPMN)

[16. Модель предметной области](#Модель)

[17. Модель базы данных](#Модель_БД)

[18. Расчет нагрузки на БД](#Расчет)

[19. Выбор архитектуры](#Выбор)

[20. Acceptance Criteria](#Acceptance)

[21. Макет интерфейса](#Макет)

[22. Тест-кейсы](#Тест)

[23. Постановка для для разработчиков в Gherkin](#Gherkin)

[24.  Проектирование ресурсной модели Open API](#Open)

**Общие сведения** 
<a name="Общие_сведения"></a> 

ООО “Рога и копыта” специализируется на ресторанном бизнесе. Компания занимает лидирующие позиции на рынке ресторанов быстрого питания. В рамках компании сложилась инициативная команда, которая смотрит в будущее и хочет запустить полностью автоматизированный ресторан под названием  "Робот и точка".

Система должна включать в себя:

Приложение для заказа блюд

Приложение для оркестрации работы роботов

Приложение для учета и заказа полуфабрикатов

Учет сроков хранения

Учет продаж

Приложения должны иметь интерфейс пользователя - для заказа или настройки 


**Основная цель проекта**
<a name="Основная_цель_проекта"></a>

Необходимо оптимизировать трудозатраты для увеличения прибыли с помощью новой системы и роботов:
1. Запуск полностью автоматизированного ресторана под названием "Робот и точка" с целью увеличения прибыли и оптимизации трудозатрат.
2. Создание системы, включающей в себя приложения для заказа блюд, оркестрации работы роботов, учета и заказа полуфабрикатов, учета сроков хранения и учета продаж.

**Метрики, критерии успешности**
<a name="Метрики"></a> 

Минимальный: Скорость обслуживания не должна уменьшиться

Максимальный: Скорость обслуживания должна вырасти на 30%

Минимальный: Операционные затраты не должны вырасти как минимум

Максимальный: Операционные затраты должны сократиться на 30%


**Процессы, которые необходимо оптимизировать**
<a name="Процессы"></a>

1. Оркестрация работы роботов для снижения времени приготовления блюд.
2. Учет и заказ полуфабрикатов для сокращения времени выдачи заказов клиентам.
3. Разработка эффективного приложения для заказа блюд для улучшения скорости обслуживания клиентов.
4. Внедрение системы учета сроков хранения для оптимизации инвентаризации и снижения операционных затрат.
5. Создание пользовательского интерфейса приложений, удовлетворяющего требованиям заказа и настройки для клиентов.

Также необходимо проработать оптимизацию времени приготовления блюд, а также улучшение операционных процессов для сокращения затрат.

**Заинтересованные лица**
<a name="Заинтересованные"></a> 

| Список стейкхолдеров                             |
| ------------------------------------------------ |
| Генеральный директор                             |
| Главный бухгалтер                                |
| Директор по ИТ                                   |
| Директор по маркетингу                           |
| Директор по продажам                             |
| Операционный директор                            |
| Финансовый директор                              |
| Продакт менеджер продукта “Робот и точка”        |
| Технолог роботизированного пищевого производства |


**Требования бизнеса**
<a name="Требования_бизнеса"></a> 

| № | Бизнес требования                                                     | Источник |
| - | --------------------------------------------------------------------- | -------- |
| 1 | Оптимизировать трудозатраты для увеличения прибыли                    | Генеральный Директор |
| 2 | Скорость обслуживания не должна уменьшиться                           | Генеральный Директор |
| 3 | Скорость обслуживания должна вырасти на 30%                           | Генеральный Директор |
| 4 | Операционные затраты не должны вырасти                                | Генеральный Директор |
| 5 | Операционные затраты должны сократиться на 30%                        | Генеральный Директор |
| 6 | Оптимизировать время выдачи заказов клиентам                          | Продакт менеджер |
| 7 | Оптимизировать время приготовления блюд                               | Продакт менеджер |
| 8 | Система должна быть готова к выпуску в течение 1 года (MVP продукта). | Продакт менеджер |

**Нефункциональные требования**
<a name="Нефункциональные"></a>

| №  | Требование                                                                                                                             | Источник             |
| -- | -------------------------------------------------------------------------------------------------------------------------------------- | -------------------- |
| 1  | Интеграция с платежной системой для осуществления оплаты через терминал                                                                | технолог             |
| 2  | Интеграция с системой заказа продуктов                                                                                                 | технолог             |
| 3  | Система должна поддерживать работу 24/7                                                                                                | Продакт менеджер     |
| 4  | Система должна быть способной обрабатывать 5000 заказов в день                                                                         | Продакт менеджер     |
| 5  | Система должна обеспечивать интеграцию с сервисами доставки для отправки заказов клиентам                                              | Продакт менеджер     |
| 6  | Система должна поддерживать масштабирование до 100 ресторанов                                                                          | Продакт менеджер     |
| 7  | Система должна использовать облачные сервисы, не требующие интеграции с текущей инфраструктурой                                        | Технический директор |
| 8  | Система должна поддерживать PC с операционной системой Windows                                                                         | Технический директор |
| 9  | Мобильное приложение должно быть доступно на IOS и Android                                                                             | Технический директор |
| 10 | Система по хранению продуктов должна быть написана с нуля                                                                              | Технический директор |
| 11 | Необходима база данных для хранения информации о продуктах                                                                             | Технический директор |
| 12 | Downtime системы не должен превышать 10 минут                                                                                          | Технический директор |
| 13 | Система должна иметь систему оповещений о сбоях, например, Apex                                                                        | Технический директор |
| 14 | Необходим стандартный мониторинг системы, например, Grafana.                                                                           | Технический директор |
| 15 | Система должна выдерживать 5000 заказов в день и одновременно 100 сессий.<br>При масштабировании до 10000 сессий одновременно.         | Технический директор |
| 16 | Система должна быть доступна на русском языке                                                                                          | Технический директор |
| 17 | Для мобильного приложения должна быть поддержка СБП<br>Для терминала должна быть поддержка обычной оффлайн кассы приема кредитных карт | Технический директор |


**Пользовательские требования**
<a name="Пользовательские"></a>

| № | Требование                                                                                      | Источник             |
| - | ----------------------------------------------------------------------------------------------- | -------------------- |
| 1 | Интерфейс для мониторинга и управления роботами                                                 | технолог             |
| 2 | Интерфейс для оформление заказов и оплаты в мобильном приложении клиентов                       | технолог             |
| 3 | Интерфейс для редактирования меню блюд для администратора ресторана                             | технолог             |
| 4 | Интерфейс для управления складскими процессами сотрудникам бекофиса                             | технолог             |
| 5 | Сотрудники бизнес-отдела должны иметь доступ к отчетам.                                         | Технический директор |
| 6 | Клиенты должны иметь возможность делать заказы через приложение                                 | Технический директор |
| 7 | Сотрудник по технологическим картам блюд должен иметь доступ к интерфейсу для работы с картами. | Технический директор |
| 8 | Сотрудники первой линии поддержки должны иметь доступ к системе для решения инцидентов системы  | Технический директор |
| 9 | Технолог должен получать уведомления о сбоях                                                    | Технический директор |

**Системные требования**
<a name="Системные"></a>

| № | Требование                                                                    | Источник         |
| - | ----------------------------------------------------------------------------- | ---------------- |
| 1 | АРМ (автоматизированное рабочее место) менеджера для управления рестораном    | технолог         |
| 2 | Необхоимо разработать web приложение для оформления заказов                   | Продакт менеджер |
| 3 | Необхоимо разработать мобильное приложение для оформления заказов             | Продакт менеджер |
| 4 | Необхоимо разработать приложение для оффлайн терминала для оформления заказов | Продакт менеджер |

**Функциональные требования**
<a name="Функциональные"></a>

| № | Требование                                                                                      | Источник             |
| - | ----------------------------------------------------------------------------------------------- | -------------------- |
| 1 | Программная поддержка для работы с роботами на точках с оборудованием (тостер, гриль, заправка) | технолог             |
| 2 | Возможность мониторинга и управления роботами                                                   | технолог             |
| 3 | Возможность мониторинга остатков                                                                | технолог             |
| 4 | АРМ (автоматизированное рабочее место) менеджера для управления рестораном                      | технолог             |
| 5 | Необхоимо разработать web приложение для оформления заказов                                     | Продакт менеджер     |
| 6 | Необхоимо разработать мобильное приложение для оформления заказов                               | Продакт менеджер     |
| 7 | Необхоимо разработать приложение для оффлайн терминала для оформления заказов                   | Продакт менеджер     |
| 8 | Система должна формировать отчет по количеству заказов.                                         | Технический директор |


 - [Miro (полная версия)](https://miro.com/welcomeonboard/TW0xZXBtOEEwaVpBNWJIcnZEcW1qYkJuNWN1RFJwcG0xd2FzZzVBa2VDTDU3bmhNdzRRN2FnZDRiU2FvTkRLSnwzNDU4NzY0NTIzNjk5NzU4NDczfDI=?share_link_id=699446562339)

**Карта пользовательских историй** 
<a name="Карта"></a>

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/Карта%20пользовательских%20историй%20.png)

**US клиент** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/Acceptance%20Criteria/US.png)

**US Сотрудник производства** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/US%20Сотрудник%20производства.png)


**US Менеджер зала** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/US%20Менеджер%20зала.png)

**US Менеджер ассортимента** 

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/User%20Story/US%20Менеджер%20ассортимента.png)


**Defenition of Ready** 
<a name="dor"></a>

- US имеет ясное и краткое описание
- DоD определены и утверждены командой
- Все необходимые ресурсы, технические спецификации и прототипы доступны
- Все зависимости от других US зафиксированы
- US приоритезирована и оценена командой
- Команда договорилась об Acceptance Criteria


**Defenition of Done** 
<a name="dod"></a>

- Соответствует определенным ожиданиям стейкхолдеров
- Успешно завершено тестирование в соответствии с критериями приемки
- Владелец продукта (Product Owner) принял задачу
- Регрессионные тесты проходят
- Выполнены нефункциональные требования
- Обновлена пользовательская документация


**BPMN бизнес-процесса оформление заказа**
<a name="BPMN"></a>

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/BPMN/Робот%20и%20точка%20оформление%20заказа.png)

**BPMN бизнес-процесса регистрация клиента**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/BPMN/Робот%20и%20точка%20регистрация%20клиента.png)

**Описание кейса**

Человек приходит к нам в ресторан и обращается к информационному меню. На
стойке он может выбрать категорию блюд (бургеры, напитки, прочее), затем конкретное
блюдо, добавить его в корзину. Когда клиент выбрал все что ему нужно и готов
оплатить заказ, то ему нужно показать полный список заказанного.
При этом, если у клиента есть бургер, то нужно дополнительно предложить к заказу
картошку и пирожок.
При сумме заказа более 1500 рублей или наличии специального комбо, мы даем в
подарок фирменный стакан “робот и точка”. При этом, если заказ происходит в будние
дни с 10 до 16, то сделать скидку, т.к. это будет считаться бизнес-ланчем.
Клиент указывает где он будет есть, с собой или в зале.
Перед оплатой, важно спросить является ли клиент участником нашей системы
лояльности. Если нет, то предложить зарегистрироваться. Если да, то предложить
начислить или списать баллы.
После этого, подсчитать итоговую сумму с учетом бонусов, если они были
использованы и перейти к процессу оплаты.


**Модель предметной области**
<a name="Модель"></a>

**Диаграмме-классов**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/UML/uml_er.png)

**Диаграмма состояний**

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/UML/uml_s.png)


**Модель C4: компонентная архитектура приложения**

Микросервисная архитектура является эффективным подходом для разработки приложений, которые должны масштабироваться и быть гибкими в изменении. В случае инфраструктуры для автоматизации бизнес-процессов ресторана “Робот И Точка”, микросервисная архитектура может предоставить следующие преимущества:

Гибкость: Микросервисы могут быть разработаны и развернуты независимо друг от друга, что позволяет быстро вносить изменения в приложение без необходимости перезапуска всего приложения.

Масштабируемость: Микросервисы могут быть масштабированы отдельно друг от друга, что позволяет легко управлять нагрузкой на приложение и обеспечивать высокую доступность.

Устойчивость: Если один из микросервисов не работает, остальные микросервисы могут продолжать работу, что обеспечивает устойчивость приложения в целом.

Легкость разработки: Разработчики могут работать над отдельными микросервисами, что упрощает процесс разработки и тестирования.

Легкость внедрения новых функций: Новые функции могут быть добавлены в виде новых микросервисов, что позволяет быстро внедрять новые возможности в приложение.


![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/Модель%20C4/C4.png)

**Модель базы данных** 
<a name="Модель_БД"></a>

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/БД%20нагрузка/robot.png)

| Сущность         | clients                          |
| ---------------- | -------------------------------- |
| Описание         | Справочник клиентов              |
| Атрибут сущности | Описание атрибута                |
| client_id        | Идентификатор клиента<br>        |
| FIO              | ФИО                              |
| tel              | Телефон                          |
| email            | Почта                            |
| start_dt         | Дата регистрации                 |
| Сущность         | orders                           |
| Описание         | Cущность заказов клиентов        |
| Атрибут сущности | Описание атрибута                |
| order_id         | Идентификатор заказа             |
| client_id        | Идентификатор клиента<br>        |
| order_dt         | Время заказа (смены статуса)     |
| status           | Статус заказа                    |
| type             | Способ получения заказа          |
| Сущность         | sessions                         |
| Описание         | Cущность сессий клиентов         |
| Атрибут сущности | Описание атрибута                |
| session_id       | Идентификатор сессии             |
| client_id        | Идентификатор клиента<br>        |
| auth_status      | Статус авторизации               |
| auth_type        | Способ авторизации               |
| purchase_flg     | Флаг покупки                     |
| session_dt       | Дата сессии                      |
| Сущность         | orders_items                     |
| Описание         | Cущность позиций заказов         |
| Атрибут сущности | Описание атрибута                |
| order_id         | Идентификатор заказа             |
| item_id          | Идентификатор товара             |
| item_count       | Кол-во товара одной позиции      |
| price            | Цена                             |
| discount         | Размер скидки                    |
| Сущность         | orders_payment                   |
| Описание         | Cущность оплаты заказов клиентов |
| Атрибут сущности | Описание атрибута                |
| order_id         | Идентификатор заказа             |
| price            | Сумма заказа                     |
| written_off      | Списанные баллы                  |
| awarded          | Начисленные баллы                |
| payment_dt       | Дата оплаты                      |
| payment_status   | Статус оплаты                    |
| payment_type     | Тип оплаты                       |
| Сущность         | clients_loaylty                  |
| Описание         | Cущность кол-во баллов клиентов  |
| Атрибут сущности | Описание атрибута                |
| client_id        | Идентификатор клиента            |
| point_count      | Кол-во баллов                    |
| count_dt         | Дата подсчета                    |
| Сущность         | clients_loaylty                  |
| Описание         | Cущность кол-во баллов клиентов  |
| Атрибут сущности | Описание атрибута                |
| Сущность         | dishs                            |
| Описание         | Cущность блюд из меню            |
| Атрибут сущности | Описание атрибута                |
| dish_id          | Идентификатор блюда              |
| category_id      | Идентификатор категории          |
| name             | Наименование блюда               |
| price            | Цена блюда                       |
| Сущность         | dishs_recipe                     |
| Описание         | Cущность рецептов блюда          |
| Атрибут сущности | Описание атрибута                |
| dish_id          | Идентификатор блюда              |
| ingredient_id    | Идентификатор ингредиента        |
| ingredient_count | Кол-во ингредиента               |
| position         | Позиция ингредиента              |
| Сущность         | categorys                        |
| Описание         | Cущность категорий меню          |
| Атрибут сущности | Описание атрибута                |
| category_id      | Идентификатор категории          |
| name             | Наименование категории           |
| Сущность         | ingredients                      |
| Описание         | Cущность категорий меню          |
| Атрибут сущности | Описание атрибута                |
| ingredient_id    | Идентификатор ингредиента        |
| name             | Наименование ингредиента         |



**Требования к производительности**
<a name="Рассчет"></a>

| Требования к производительности    | 50-й процентиль | 90-й процентиль | 99-й процентиль |
| ---------------------------------- | --------------- | --------------- | --------------- |
| Макс. Транзакций в секунду на базу | 500             | 1000            | 2000            |
| Макс. Сокет соединений на базу     | 56              | 128             | 256             |
| Операции чтения, %                 | 55              | 60              | 30              |
| Операции записи, %                 | 45              | 40              | 70              |
| Случайные операции, %              | 70              | 80              | 90              |
| Последовательные операции, %       | 30              | 20              | 10              |
| Мин. Задержка репликации, секунд   | 2               | 3               | 5               |



**Первичная нагрузка**

| Запросы                                                  | Частота      | Сложность | Типы дисков | Партицирование | Таблица                                   |
| -------------------------------------------------------- | ------------ | --------- | ----------- | -------------- | ----------------------------------------- |
| Селект на просмотр / поиск блюд                          | часто        | 1         | NVMe        | Partition_01   | dishs                                     |
| Селект на просмотр / поиск клиентов                      | часто        | 1         | NVMe        | Partition_01   | clients                                   |
| Селект на просмотр баллов клиентов                       | часто        | 1         | NVMe        | Partition_01   | clients_loaylty                           |
| Селект на просмотр / поиск заказов                       | часто        | 1         | NVMe        | Partition_01   | orders                                    |
| Селект на просмотр состава заказов                       | часто        | 1         | NVMe        | Partition_01   | orders_dishs                              |
| Селект на просмотр оплаты заказов                        | часто        | 1         | NVMe        | Partition_01   | orders_payment                            |
| Селект на просмотр сессий клиентов                       | часто        | 1         | NVMe        | Partition_01   | sessions                                  |
| Селект на просмотр состава блюд                          | часто        | 1         | NVMe        | Partition_01   | dishs_recipe                              |
| Селект на просмотр ингредиентов                          | часто        | 1         | NVMe        | Partition_01   | ingredients                               |
| Добавление клиента в справочник                          | часто        | 2         | SSD         | Partition_02   | clients                                   |
| Добавление блюда в меню                                  | часто        | 2         | SSD         | Partition_02   | dishs                                     |
| Редактирование состава блюд                              | часто        | 2         | SSD         | Partition_02   | dishs_recipe                              |
| Пересчет баллов клиента                                  | часто        | 2         | SSD         | Partition_02   | clients_loaylty                           |
| Редактировать статус заказа                              | часто        | 2         | SSD         | Partition_02   | orders                                    |
| Среднее время жизненного цикла заказа в разрезе статусов | часто        | 2         | SSD         | Partition_02   | orders                                    |
| Отчет за квартал по категориям                           | периодически | 3         | HDD         | Partition_03   | orders + orders_dishs + dishs + categorys |
| Отчет за квартал по блюдам                               | периодически | 3         | HDD         | Partition_03   | orders + orders_dishs + dishs             |
| Отчет за квартал по программе лояльности                 | периодически | 3         | HDD         | Partition_03   | clients_loaylty                           |
| Отчет за квартал по всем заказам в разрезе статусов      | периодически | 3         | HDD         | Partition_03   | orders                                    |

Преобладать будут простые частые запросы на поиск, и создание (т. е. OLTP система).
Однако в рамках приложения необходимо будет предоставление аналитики, статистики как в целом, так и по конкретным точкам и позициям. (т. е. сложные запросы также будут, но будут выполняться раз в неделю или раз в месяц).


**Нагрузка на cистему**

Исходя из бизнес требований полученных на интервью можно прогнозировать нагрузку 

1 Год:


1 ресторан
5000 заказов в день


| Общее количество пользователей           | 2 000 | человек                                              |
| ---------------------------------------- | ----- | ---------------------------------------------------- |
| Целевое количество пользователей системы | 1 800 | человек                                              |
| Пользователей в пике                     | 782   | человек                                              |
| Частота обращений пользователей в базу   | 5     | раз в минуту                                         |
| Всего обращений в базу в секунду         | 65    | транзакций в секунду                                 |
| Работающий клиент TCP                    | 15%   | одновременно работающих из всего числа пользователей |
| что дает                                 | 117   | постоянно действующих TCP сессий                     |
| Макс. Сокет соединений на базу           | 128   | сессий в секунду                                     |
| Макс. Транзакций в секунду на базу       | 1 000 | транзакций в секунду                                 |
| Выводы                                   |       |                                                      |
| Серверов баз данных                      | 0,92  | Из расчета сокетов TCP сессий                        |
| Серверов баз данных                      | 0,07  | Из расчета - транзакция в секунду                    |


3 года:

50 ресторанов
250000 заказов в день


| Общее количество пользователей           | 100 000 | человек                                              |
| ---------------------------------------- | ------- | ---------------------------------------------------- |
| Целевое количество пользователей системы | 90 000  | человек                                              |
| Пользователей в пике                     | 832     | человек                                              |
| Частота обращений пользователей в базу   | 5       | раз в минуту                                         |
| Всего обращений в базу в секунду         | 69      | транзакций в секунду                                 |
| Работающий клиент TCP                    | 15%     | одновременно работающих из всего числа пользователей |
| что дает                                 | 125     | постоянно действующих TCP сессий                     |
| Макс. Сокет соединений на базу           | 128     | сессий в секунду                                     |
| Макс. Транзакций в секунду на базу       | 1 000   | транзакций в секунду                                 |
| Выводы                                   |         |                                                      |
| Серверов баз данных                      | 0,98    | Из расчета сокетов TCP сессий                        |
| Серверов баз данных                      | 0,07    | Из расчета - транзакция в секунду                    |


5 лет:

100 ресторанов
500000 заказов в день


| Общее количество пользователей           | 200 000 | человек                                              |
| ---------------------------------------- | ------- | ---------------------------------------------------- |
| Целевое количество пользователей системы | 180 000 | человек                                              |
| Пользователей в пике                     | 1 412   | человек                                              |
| Частота обращений пользователей в базу   | 5       | раз в минуту                                         |
| Всего обращений в базу в секунду         | 118     | транзакций в секунду                                 |
| Работающий клиент TCP                    | 15%     | одновременно работающих из всего числа пользователей |
| что дает                                 | 212     | постоянно действующих TCP сессий                     |
| Макс. Сокет соединений на базу           | 128     | сессий в секунду                                     |
| Макс. Сокет соединений на базу           | 128     | транзакций в секунду                                 |
| Выводы                                   |         |                                                      |
| Серверов баз данных                      | 1,65    | Из расчета сокетов TCP сессий                        |
| Серверов баз данных                      | 0,92    | Из расчета - транзакция в секунду                    |



**Размер БД**

| Метрики                                        | через  1 год | через 3 года | через 5 лет |
| ---------------------------------------------- | ------------ | ------------ | ----------- |
| Количество пользователей (U)                   | 2000         | 100000       | 200000      |
| Количество записей в день (L)                  | 5000         | 250000       | 500000      |
| Количество дней в году (D)                     | 365          | 365          | 365         |
| Количество лет истории (Y)                     | 1            | 3            | 5           |
| Средний размер записи (S) в Кб                 | 0,23         | 0,23         | 0,23        |
| Усредненный размер индекса на элемент (I) в Кб | 0,0064       | 0,0064       | 0,0064      |
| Количество индексов (A)                        | 4            | 4            | 4           |
| Коэффициент накладных расходов базы (E)        | 1,4          | 1,4          | 1,4         |
| Количество версий (V)                          | 1            | 1            | 1           |
| Размер БД по формуле Гб                        | 1245,60928   | 9342069,63   | 62280464,2  |
| Выбор инстанса БД                              | 1000Гб       | 200000Гб     | 1000000Гб   |


**Выбор архитектуры**
<a name="Выбор"></a>

![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/БД%20нагрузка/с4drawio.png)

Использование базы данных PostgreSQL с репликацией и брокером сообщений Kafka для распределения транзакций будет наиболее эффективным по нескольким причинам.

1. Масштабируемость: PostgreSQL позволяет горизонтальное масштабирование с помощью репликации, что обеспечит возможность распределения нагрузки в зависимости от количества ресторанов и заказов. Это позволит легко расширить базу данных при увеличении объема заказов и ресторанов.

2. Надежность и целостность данных: PostgreSQL обеспечивает высокую надежность и целостность данных благодаря своей транзакционной структуре и возможности использования репликации для обеспечения отказоустойчивости.

3. Гибкость и скорость: Kafka, как брокер сообщений, предоставляет гибкую и быструю систему для распределения транзакций между ресторанами и базой данных. Это обеспечивает эффективное обновление и доступ к данным в реальном времени.

4. Масштабируемость Kafka: Kafka также обладает возможностью масштабироваться и использоваться в качестве потоковой платформы для обработки большого объема данных, что подходит для обработки множества заказов в реальном времени.

5. Производительность и оптимизация: В сочетании PostgreSql и Kafka можно достичь высокой производительности и оптимизации запросов за счет эффективного распределения данных и отправки сообщений между различными компонентами системы.

Таким образом, использование PostgreSQL с репликацией и брокером сообщений Kafka обеспечит необходимую масштабируемость, надежность, гибкость и производительность для обработки огромного объема транзакций, обусловленного возрастающим количеством ресторанов и заказов.



 ![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/Acceptance%20Criteria/US.png)
 
 - [Miro (полная версия)](https://miro.com/welcomeonboard/TW0xZXBtOEEwaVpBNWJIcnZEcW1qYkJuNWN1RFJwcG0xd2FzZzVBa2VDTDU3bmhNdzRRN2FnZDRiU2FvTkRLSnwzNDU4NzY0NTIzNjk5NzU4NDczfDI=?share_link_id=699446562339)

**Декомпозиция US** 

| №     | User Strory                                                                                                                 | Декомпозиция                                                                                                                                                                                                                                                                                                                                                                                       |
| ----- | --------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 01 | Я как клиент<br>ХОЧУ ознакомиться с меню<br>ЧТОБЫ выбрать блюдо                                                             | 1\. Изучение ассортимента ресторана (категории меню, актуальные позиции, детализация по блюдам, состав)<br>2\. Проектирование модели БД (ER диаграмма для меню ресторана)<br>3\. Написание DDL скриптов для создания сущностей и ETL для вставки данных<br>4\. Интеграция базы данных с интерфейсом приложения                                                                                     |
| US 09 | Я как клиент<br>ХОЧУ зарегистрироваться в программе лояльности<br>ЧТОБЫ копить и списывать бонусные баллы при оплате заказа | 1\. Изучение бизнес-правил к программе лояльности<br>2\. Разработка плана верификации пользователя для последующей регистрации / авторизации через приложения в программе лояльности<br>3\. Разработка алгоритма калькулятора баллов для программы лояльности<br>4\. Написание DDL скриптов для создания сущностей и ETL для вставки данных<br>5\. Интеграция базы данных с интерфейсом приложения |

**Acceptance Criteria** 
<a name="Acceptance"></a>

| №     | User Strory                                                                                                                      | AC                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ----- | -------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 01 | Я как клиент<br>ХОЧУ ознакомиться с меню<br>ЧТОБЫ выбрать блюдо                                                                  | 1\. Интерфейс должен отображать детализацию по блюдам в разрезе категорий<br>2\. Интерфейс должен отображать только те позиции, которые есть в наличии<br>3\. Информация о составе блюда должна быть доступна для просмотра в системе                                                                                                                                                                                                                             |
| US 02 | Я как клиент<br>ХОЧУ добавить блюда в корзину<br>ЧТОБЫ его приготовили                                                           | 1\. Кнопка добавления блюда в корзину должна быть активна, если позиция есть в наличии<br>2\. При добавлении блюд в корзину должен отображаться счетчик кол-ва позиций и их общая стоимость<br>3\. При добавлении блюда в корзину, клиент должен видеть подтверждение о том, что блюдо успешно добавлено                                                                                                                                                          |
| US 03 | Я как клиент<br>ХОЧУ оплатить заказа<br>ЧТОБЫ получить еду                                                                       | 1\. Система должна подтвердить успешную оплату заказа и отобразить информацию об этом пользователю.<br>2\. Оплата заказа должна быть доступна после добавления как минимум 1 блюда в корзину<br>3\. При неудачной оплате система должна предложить повторить операцию пользователю сохранив выбранные позиции в корзине                                                                                                                                           |
| US 04 | Я как клиент<br>ХОЧУ получить чек с номером заказа<br>ЧТОБЫ узнать готовность заказа и получить его после готовности показав чек | 1\. Чек заказа должен содержать все детали заказа (номер заказа, время заказа, позиции заказа, детали оплаты заказа)<br>2\. Система должна распечатать чек (если заказ сделан через терминал) и отправить чек заказа в электронном виде на почту клиента<br>3\. Номер заказа на чеке должен быть уникальным и соответствовать номеру заказа в системе                                                                                                             |
| US 05 | Я как клиент<br>ХОЧУ редактировать позиции в корзине<br>ЧТОБЫ скорректировать заказ                                              | 1\. Пользователю должна быть доступна возможность редактировать кол-во позиций в корзине (добавлять / удалять)<br>2\. При удалении / добавлении позиций в корзине система должна пересчитывать стоимость заказа и отображать изменения в интерфейсе<br>3\. Система должна выставлять ограничения на кол-во определенных позиций для одного заказа                                                                                                                 |
| US 06 | Я как клиент<br>ХОЧУ выбрать способ получения заказа<br>ЧТОБЫ забрать заказ удобным способом                                     | 1\. Система должна предоставлять выбор получения заказа (с собой / в ресторане)<br>2\. Система должна выставлять ограничения на получение заказа для определенных позиций и уведомлять об этом пользователя<br>3\. При подтверждении заказа система должна отображать информация о месте выдачи (заказы «с собой» и «в ресторане» выдаются на разных кассах)                                                                                                      |
| US 07 | Я как клиент<br>ХОЧУ выбрать способ оплаты заказа<br>ЧТОБЫ оплатить заказ удобным способом                                       | 1\. Оплата может быть сделана картой VISA / MASTERCARD / МИР<br>2\. Тип карты определяется автоматически в процессе ввода<br>3\. Оплату можно произвести наличными                                                                                                                                                                                                                                                                                                |
| US 08 | Я как клиент<br>ХОЧУ зарегистрироваться в программе лояльности<br>ЧТОБЫ копить и списывать бонусные баллы при оплате заказа      | 1\. При регистрации система должна направлять код верификации на почту или номер телефона клиенту<br>2\. Если клиент уже зарегистрирован система должна предложить сбросить пароль<br>3\. После регистрации система должна отображать баланс бонусных баллов в программе лояльности клиенту                                                                                                                                                                       |
| US 09 | Я как клиент<br>ХОЧУ обратиться к менеджеру<br>ЧТОБЫ получить ответы на вопросы                                                  | 1\. При создании обращения клиент должен выбрать категорию обращения из выпадающего списка<br>2\. После отправки заявки система должна отобразить номер обращения клиенту<br>3\. После отправки заявки система должна отобразить примерное время ответа менеджера                                                                                                                                                                                                 |
| US 10 | Я как клиент<br>ХОЧУ отменить заказ<br>ЧТОБЫ вернуть свои деньги                                                                 | 1\. Пользователь должен иметь возможность отменить заказ до момента его обработки и подтверждения.<br>2\. При отмене заказа пользователю должно быть предоставлено уведомление о возможности возврата денег и сроках, в течение которых это будет выполнено.<br>3\. После успешной отмены заказа пользователю должно быть автоматически возвращено полное или частичное погашение средств на тот же способ оплаты, который был использован при оформлении заказа. |


**Макет интерфейса**
<a name="Макет"></a>


![Image alt](https://github.com/dmatwe/projects/blob/main/OTUS_SA_ADVANCED/WireFrame/WireFrame.png)


<a name="Тест"></a>

| Чеклист для проверки продукта                                                                                                   |
| ------------------------------------------------------------------------------------------------------------------------------- |
| 1\. Проверить наличие меню на сайте или в приложении.                                                                           |
| 2\. Попробовать добавить блюдо в корзину и убедиться, что процесс проходит без ошибок.                                          |
| 3\. Проверить различные способы оплаты заказа (карта, наличные, онлайн-платежи).                                                |
| 4\. Убедиться, что после оплаты заказа клиент получает чек с номером заказа.                                                    |
| 5\. Проверить возможность редактирования позиций в корзине (добавление, удаление).                                              |
| 6\. Попробовать выбрать способ получения заказа (доставка, самовывоз) и удостовериться, что это работает корректно.             |
| 7\. Проверить различные способы оплаты заказа (карта, наличные, онлайн-платежи).                                                |
| 8\. Протестировать процесс регистрации в программе лояльности и проверить функционал по копированию и списанию бонусных баллов. |
| 9\. Проверить возможность обратиться к менеджеру через чат или звонок и получить ответы на вопросы.                             |
| 10\. Протестировать функционал отмены заказа и убедиться, что клиент может вернуть свои деньги без проблем.                     |


**Тест-кейсы** 

US01
Я как клиент
ХОЧУ ознакомиться с меню
ЧТОБЫ выбрать блюдо


US02
Я как клиент
ХОЧУ добавить блюда в корзину
ЧТОБЫ его приготовили


| ID                                                                         | HP_US1/2                                                               |
| -------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| Название                                                                   | Успешное добавление блюда в корзину                                    |
| Краткое описание                                                           | Отображение информации о позиции и успешное добавление блюда в корзину |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                 |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                      |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 01/User Story 02                                            |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент перешел на вкладку главного меню                                |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                           |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                                |

| Шаги воспроизведения | дейстивие пользователя                           | Ожидаемый результат                                                                                                    |
| -------------------- | ------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------- |
| шаг 1                | Выбрать вкладку главного меню ресторана          | Отобразить все категории меню                                                                                          |
| шаг 2                | Выбрать категорию бургеры                        | Отобразить список бургеров из категории бургеры<br>с кратким описанием и ценой                                         |
| шаг 3                | Выбрать бургер №1                                | Отобразить подробное описание бургера №1<br>(Состав, калории)                                                          |
| шаг 4                | Добавить бургер №1 в корзирну (нажать на кнопку) | Отобразить подтверждение об успешном добавлении блюда<br>Отобразить счетчик кол-ва позиций и их общую стоимость заказа |
| Постусловие          | Очистить корзину и завершить сессию           |

| ID                                                                         | UNHP_US1/2                                                             |
| -------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| Название                                                                   | Неуспешное добавление блюда в корзину                                  |
| Краткое описание                                                           | Отображение информации о позиции и успешное добавление блюда в корзину |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                 |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                      |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 01/User Story 02                                            |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент перешел на вкладку главного меню                                |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                           |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                                |

| Шаги воспроизведения | дейстивие пользователя                           | Ожидаемый результат                                                            |
| -------------------- | ------------------------------------------------ | ------------------------------------------------------------------------------ |
| шаг 1                | Выбрать вкладку главного меню ресторана          | Отобразить все категории меню                                                  |
| шаг 2                | Выбрать категорию бургеры                        | Отобразить список бургеров из категории бургеры<br>с кратким описанием и ценой |
| шаг 3                | Выбрать бургер №1                                | Отобразить подробное описание бургера №1<br>(Состав, калории)                  |
| шаг 4                | Добавить бургер №1 в корзирну (нажать на кнопку) | Кнопка добавить в корзину неактивна                                            |
| Постусловие          | Завершить сессию                                 |


US 03 Я как клиент
ХОЧУ оплатить заказа
ЧТОБЫ получить еду

US 04 Я как клиент
ХОЧУ получить чек с номером заказа
ЧТОБЫ узнать готовность заказа и получить его после готовности показав чек

US 07 Я как клиент
ХОЧУ выбрать способ оплаты заказа
ЧТОБЫ оплатить заказ удобным способом

| ID                                                                         | HP_US3/4/7_1                                              |
| -------------------------------------------------------------------------- | --------------------------------------------------------- |
| Название                                                                   | Успешная оплата заказа картой и получение чека            |
| Краткое описание                                                           | Осуществить оплату и получить чек с информацией по заказу |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                    |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                         |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 03/User Story 04/ User Story 07                |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент сформировал заказ и перешел на страницу оплаты     |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android              |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                   |

| Шаги воспроизведения | дейстивие пользователя                                                                                                                | Ожидаемый результат                                                                                                         |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| шаг 1                | Перейти на страницу оплаты                                                                                                            | Отобразить выбор способа оплаты                                                                                             |
| шаг 2                | Выбрать оплату картой                                                                                                                 | Отобразить поля ввода для оплаты картой<br>(номер карты, месяц/год, cvv, фамилию и имя)                                     |
| шаг 3                | Ввести реквизиты банковской карты<br><br>Номер карты: 5555 5555 5555 5555<br>месяц/год: 12/29<br>cvv: 555<br>фамилию и имя: TEST TEST | Отобразить тип карты (МИР)                                                                                                  |
| шаг 4                | Оплатить заказ (нажать на кнопку)                                                                                                     | Запросить код подтверждения через СМС                                                                                       |
| шаг 5                | Подтвердить оплату (ввести код)                                                                                                       | Отобразить уведомление об успешной оплате<br>Отправить чек на email<br>Распечатать чек если заказ был сделан через терминал |
| Постусловие          | Завершить сессию                                                                                                                      |


| ID                                                                         | HP_US3/4/7_2                                                        |
| -------------------------------------------------------------------------- | ------------------------------------------------------------------- |
| Название                                                                   | Успешная оплата заказа наличными и получение чека                   |
| Краткое описание                                                           | Осуществить оплату наличными и получить чек с информацией по заказу |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                              |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                   |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 03/User Story 04/ User Story 07                          |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент сформировал заказ и перешел на страницу оплаты               |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                        |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                             |

| Шаги воспроизведения | дейстивие пользователя                       | Ожидаемый результат                                                               |
| -------------------- | -------------------------------------------- | --------------------------------------------------------------------------------- |
| шаг 1                | Перейти на страницу оплаты                   | Отобразить выбор способа оплаты                                                   |
| шаг 2                | Выбрать оплату наличными                     | Получить QR-код для оплаты заказа<br>Отобразить номер кассы для внесения наличных |
| шаг 3                | Предъявить QR-код на кассе и внести наличные | Получить чек с информацией по заказу                                              |
| Постусловие          | Завершить сессию                             |

| ID                                                                         | UNHP_US3/7                                            |
| -------------------------------------------------------------------------- | ----------------------------------------------------- |
| Название                                                                   | Неуспешная оплата заказа картой                       |
| Краткое описание                                                           | Неудачная попытка оплаты картой                       |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                     |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 03 / User Story 07                         |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент сформировал заказ и перешел на страницу оплаты |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android          |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                               |

| Шаги воспроизведения | дейстивие пользователя                                                                                                                | Ожидаемый результат                                                                     |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| шаг 1                | Перейти на страницу оплаты                                                                                                            | Отобразить выбор способа оплаты                                                         |
| шаг 2                | Выбрать оплату картой                                                                                                                 | Отобразить поля ввода для оплаты картой<br>(номер карты, месяц/год, cvv, фамилию и имя) |
| шаг 3                | Ввести реквизиты банковской карты<br><br>Номер карты: 5555 5555 5555 5555<br>месяц/год: 12/29<br>cvv: 555<br>фамилию и имя: TEST TEST | Отобразить тип карты (МИР)                                                              |
| шаг 4                | Оплатить заказ (нажать на кнопку)                                                                                                     | Запросить код подтверждения через СМС                                                   |
| шаг 5                | Подтвердить оплату (ввести некорректный код)                                                                                          | Отобразить уведомление об ошибке<br>Предложить вернуться к выбору способа оплаты        |
| Постусловие          | Завершить сессию                                                                                                                      |


US 05 Я как клиент
ХОЧУ редактировать позиции в корзине
ЧТОБЫ скорректировать заказ


| ID                                                                         | HP_US5                                                                |
| -------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| Название                                                                   | Успешное редактирование корзины                                       |
| Краткое описание                                                           | Отредактировать корзину, удалить и добавить позиции                   |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                     |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 05                                                         |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент добавил позиции в корзину (Бургер №1 - 1 шт, Бургер №2 - 2 шт) |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                          |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                               |

| Шаги воспроизведения | дейстивие пользователя                            | Ожидаемый результат                                                                                                                                       |
| -------------------- | ------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| шаг 1                | Перейти в корзину                                 | Отобразить список позиций в корзине<br>Бургер №1 - 1 шт<br>Бургер №2 - 2 шт                                                                               |
| шаг 2                | Удалить Бургер №1 (-1)<br>Добавить Бургер №2 (+1) | Удалить позицию Бургер №1 из заказа<br>Добавить позицию Бургер №2, отобразить кол-во = 3 шт<br>Отобразить новую стоимость заказа                          |
| шаг 3                | Добавить максимальное кол-во Бургер №2 (+7)       | Добавить позиции Бургер №2, отобразить кол-во = 10 шт<br>Кнопка добавления позиции в корзину для Бургер №2 неактивна<br>Отобразить новую стоимость заказа |
| Постусловие          | Отчистить корзину, завершить сессию               |


US 06 Я как клиент
ХОЧУ выбрать способ получения заказа
ЧТОБЫ забрать заказ удобным способом

| ID                                                                         | HP_US6                                                                |
| -------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| Название                                                                   | Успешный выбор способа получения заказа - в ресторане                 |
| Краткое описание                                                           | Выбрать способ получения заказа                                       |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                     |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 06                                                         |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент сформировал заказ и перешел на вкладку выбора получения заказа |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                          |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                               |

| Шаги воспроизведения | дейстивие пользователя                        | Ожидаемый результат                                           |
| -------------------- | --------------------------------------------- | ------------------------------------------------------------- |
| шаг 1                | Перейти на вкладку выбора получения заказа    | Отобразить варианты получения заказа<br>с собой / в ресторане |
| шаг 2                | Выбрать способ получения заказа - в ресторане | Перейти на страницу оплаты заказа                             |
| Постусловие          | Отчистить корзину, завершить сессию           |


| ID                                                                         | UNHP_US6                                                                                                |
| -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| Название                                                                   | Неуспешный выбор способа получения заказа - с собой                                                     |
| Краткое описание                                                           | Выбрать способ получения заказа с собой                                                                 |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                                                  |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                                                       |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 06                                                                                           |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент сформировал заказ (добавил в корзину XXL ICE CREAM) и перешел на вкладку выбора получения заказа |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                                                            |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                                                                 |

| Шаги воспроизведения | дейстивие пользователя                     | Ожидаемый результат                                                                                                             |
| -------------------- | ------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| шаг 1                | Перейти на вкладку выбора получения заказа | Отобразить варианты получения заказа<br>с собой / в ресторане                                                                   |
| шаг 2                | Выбрать способ получения заказа - с собой  | Отобразить уведомление, что<br>блюдо XXL ICE CREAM подается только в ресторане<br>и предложить изменить способ получения заказа |
| Постусловие          | Отчистить корзину, завершить сессию        |


US 08 Я как клиент
ХОЧУ зарегистрироваться в программе лояльности
ЧТОБЫ копить и списывать бонусные баллы при оплате заказа

| ID                                                                         | HP_US8                                                                                  |
| -------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| Название                                                                   | Успешная регистрация клиента в программе лояльности, проверка введенных данных пройдена |
| Краткое описание                                                           | Зарегистрировать в программе лояльности                                                 |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                                  |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                                       |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 08                                                                           |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент не зарегистрирован в системе                                                     |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                                            |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                                                 |

| Шаги воспроизведения | дейстивие пользователя                                                                                                          | Ожидаемый результат                                                                                                                                                                            |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| шаг 1                | Перейти на вкладку регистрации в программе лояльности                                                                           | Отобразить поля ввода для регистрации<br><br>ФИО <br>Телефон<br>EMAIL<br>Дата рождения                                                                                                         |
| шаг 2                | Ввести корректные данные<br><br>ФИО: TEST TEST TEST<br>Телефон: 88005553555<br>EMAIL: test@mail.ru<br>Дата рождения: 1900-01-01 | Введены корректные данные                                                                                                                                                                      |
| шаг 3                | Подтвердить ввод (нажать кнопку Зарегистрировать)                                                                               | Направить код верификации на почту и номер телефона<br>Отобразить окно для ввода кода                                                                                                          |
| шаг 4                | Ввести код верификации                                                                                                          | Успешная регистрация<br>Клиент зарегистрирован в системе:<br>1) Появилась запись о клиенте в списке<br>зарегистрированных клиентов<br>2) На экране появилось сообщение об успешной регистрации |
| Постусловие          | Удалить регистрацию клиента: удалить запись о<br>регистрации клиента в таблице зарегистрированных                               |

| ID                                                                         | UNHP_US8                                                                          |
| -------------------------------------------------------------------------- | --------------------------------------------------------------------------------- |
| Название                                                                   | Неуспешная регистрация клиента в программе лояльности, клиент уже зарегистрирован |
| Краткое описание                                                           | При регистрации использовать номер, который уже есть в системе                    |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                                            |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                                                 |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 08                                                                     |
| Предусловия (что и как подготовлено к воспроизведению)                     | Номер зарегистрирован в системе                                                   |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android                                      |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                                                           |

| Шаги воспроизведения | дейстивие пользователя                                                                                                          | Ожидаемый результат                                                                                    |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| шаг 1                | Перейти на вкладку регистрации в программе лояльности                                                                           | Отобразить поля ввода для регистрации<br><br>ФИО <br>Телефон<br>EMAIL<br>Дата рождения                 |
| шаг 2                | Ввести корректные данные<br><br>ФИО: TEST TEST TEST<br>Телефон: 88888888888<br>EMAIL: test@mail.ru<br>Дата рождения: 1900-01-01 | Введены корректные данные                                                                              |
| шаг 3                | Подтвердить ввод (нажать кнопку Зарегистрировать)                                                                               | система отражает сообщение о том, что пользователь<br>уже зарегистрирован и предлагает сбросить пароль |
| Постусловие          | Завершить сессию                                                                                                                |


US 09 Я как клиент
ХОЧУ обратиться к менеджеру
ЧТОБЫ получить ответы на вопросы

| ID                                                                         | HP_US9                                       |
| -------------------------------------------------------------------------- | -------------------------------------------- |
| Название                                                                   | Успешная отправка обращения менеджеру        |
| Краткое описание                                                           | Отправка обращения менеджеру                 |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент       |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)            |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 09                                |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент зарегистрирован в системе             |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                      |

| Шаги воспроизведения | дейстивие пользователя                                                                 | Ожидаемый результат                                                                         |
| -------------------- | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| шаг 1                | Перейти на вкладку создания обращений                                                  | Отобразить список категорий обращений<br><br>Вопрос по оплате<br>Вопрос по заказу<br>Другое |
| шаг 2                | Выбрать "другое",<br>написать комментарий: Test<br>Отправить обращение нажав на кнопку | система отображает номер обращения и примерное время ответа менеджера                       |
| Постусловие          | Удалить обращение клиента из системы                                                   |


US 10 Я как клиент
ХОЧУ отменить заказ
ЧТОБЫ вернуть свои деньги

| ID                                                                         | HP_US10                                               |
| -------------------------------------------------------------------------- | ----------------------------------------------------- |
| Название                                                                   | Успешная отправка заявки на возврат средств           |
| Краткое описание                                                           | Отправка заявки на возврат средств                    |
| Вышестоящая фича / доработка / задача                                      | Основная задача: MVP User Story Клиент                |
| Автор                                                                      | Системный аналитик (Матвеев Д.О.)                     |
| Где описана постановка (ссылка, версия, название документа/раздела)        | User Story 10                                         |
| Предусловия (что и как подготовлено к воспроизведению)                     | Клиент зарегистрирован в системе и совершил заказ<br> |
| Окружение (ОС, браузер, разрешение экрана, скорость сети, доступность GPS) | Терминал в ресторане, приложение IOS/Android          |
| Приоритет (влияет на порядок обработки)                                    | Высокий                                               |

| Шаги воспроизведения | дейстивие пользователя                                                                                                        | Ожидаемый результат                                                                                               |
| -------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- |
| шаг 1                | Перейти на вкладку возврата средств                                                                                           | Система предлагает выбрать причины возврата<br><br>Перепутали заказ<br>Не получил заказ<br>Что-то не так с блюдом |
| шаг 2                | Выбрать "Что-то не так с блюдом"<br>Указать id заказа: 0001<br>написать комментарий: Test<br>Отправить заявку нажав на кнопку | Система отображает уведомление об успешном возврате и сроки возврата средств                                      |
| Постусловие          | Удалить заявку клиента из системы                                                                                             |

**Постановка для для разработчиков в Gherkin**
<a name="Gherkin"></a>

| №     | User Strory                                                     | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ----- | --------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 01 | Я как клиент<br>ХОЧУ ознакомиться с меню<br>ЧТОБЫ выбрать блюдо | 1\. Сценарий просмотра меню<br>GIVEN пользователь смотрит список категорий<br>WHEN пользователь переходит на вкладку каталог<br>THEN пользователю отображается <список категорий><br><br>2\. Сценарий просмотра блюд из категории<br>GIVEN пользователь смотрит позиции категории «Бургеры»<br>WHEN пользователь инициирует переход на категорию «Бургеры»<br>THEN пользователю отображается <список бургеров><br><br>3\. Сценарий поиска бургера, которого нет в наличии<br>GIVEN пользователь ищет Бургер 5, который он заказывал в прошлый раз, но в данный момент позиция закончилась<br>WHEN пользователь инициирует переход на категорию «Бургеры»<br>THEN пользователю отображается <список бургеров><br>AND система не отображает бургер 5, так как его нет в наличии<br> |

**Списки**

| Список категорий | Список бургеров |
| ---------------- | --------------- |
| Бургеры          | Бурегр 1        |
| Напитки          | Бургер 2        |
| Десерты          | Бургер 3        |
| Гарниры          | Бургер 4        |
| Комбо            | Бургер 5        |
| Акции            | Бургер 6        |


| №     | User Strory                                                                | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ----- | -------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 02 | Я как клиент<br>ХОЧУ добавить блюда в корзину<br>ЧТОБЫ его приготовили<br> | 1\. Сценарий добавления блюда в корзину<br>GIVEN пользователь добавляет блюдо в корзину<br>WHEN пользователь инициирует добавление блюда в корзину<br>THEN пользователю отображается успешное добавление блюда в корзину<br>AND срабатывает счетчик кол-ва позиций и их общая стоимость заказа<br><br>2\. Сценарий добавления блюда в корзину, которого временно нет в наличии<br>GIVEN пользователь пытается добавить блюдо в корзину, которого временно нет в наличии<br>WHEN пользователь пытается инициировать добавление блюда в корзину, которого временно нет в наличии<br>THEN кнопка добавления в корзину неактивна |

Нет в наличии – означает, что позиции не будет в наличии в ближайшее время, такие позиции не отображаются в интерфейсе клиента

Временно нет в наличии - означает, что позиции нет в наличии, но в ближайшее время появятся, такие позиции отображаются, но кнопка добавить в корзину неактивна 



| №     | User Strory                                                | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ----- | ---------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 03 | Я как клиент<br>ХОЧУ оплатить заказа<br>ЧТОБЫ получить еду | 1\. Сценарий оплата заказа<br>GIVEN пользователь оплачивает заказ<br>WHEN пользователь инициирует оплату заказа<br>THEN пользователю отображается уведомление успешной оплаты заказа<br><br>2\. Сценарий невозможной оплаты заказа<br>GIVEN пользователь пытается оплатить пустой заказ<br>WHEN пользователь инициирует переход в корзину<br>THEN пользователю отображается информация, что корзина пуста и оплата невозможна<br><br>3\. Сценарий неудачной оплаты заказа<br>GIVEN пользователь пытается оплатить заказ<br>WHEN пользователь инициирует оплату заказа<br>THEN пользователю отображается информация об ошибке и предлагается вернуться назад в корзину для повторной попытки<br> |



| №     | User Strory                                                                                                                      | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ----- | -------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 04 | Я как клиент<br>ХОЧУ получить чек с номером заказа<br>ЧТОБЫ узнать готовность заказа и получить его после готовности показав чек | 1\. Сценарий получения чека<br>GIVEN пользователь оплатил заказ и получает чек<br>WHEN пользователю отображается уведомление успешной оплаты заказа<br>THEN система печатает чек (если заказ сделан через терминал)<br>AND отправляет чек заказа в электронном виде на почту клиента<br><br>2\. Сценарий получения чека если заказ сделан через терминал, но печать невозможна из-за технических неполадок<br>GIVEN пользователь оплатил заказ и получает чек только в электронном виде<br>WHEN пользователю отображается уведомление успешной оплаты заказа<br>THEN пользователю отображается информация о сбое печати чека и об отправке эл. чека на почту<br>AND система отправляет чек заказа в электронном виде на почту клиента<br><br>3\. Сценарий генерации чека<br>GIVEN пользователь оплатил заказ и система генерирует чек<br>WHEN пользователю отображается уведомление успешной оплаты заказа<br>THEN генерирует чек с атрибутами: номер заказа, время заказа, позиции заказа, способ оплаты заказа<br> |


| №     | User Strory                                                                         | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ----- | ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 05 | Я как клиент<br>ХОЧУ редактировать позиции в корзине<br>ЧТОБЫ скорректировать заказ | 1\. Сценарий редактирования позиций в корзине<br>GIVEN пользователь редактирует позиции заказа в корзине<br>WHEN пользователь удаляет / добавлять позиции в корзине<br>THEN система пересчитывает стоимость заказа<br>AND отображает изменения в интерфейсе<br><br>2\. Сценарий ограничения добавления кол-ва позиции в корзину<br>GIVEN Система ограничивает добавление кол-ва позиции в корзину<br>WHEN пользователь добавляет максимальное кол-во позиции в корзину<br>THEN кнопка добавления позиции в корзину становится не активна<br><br>3\. Сценарий удаления позиции из корзины<br>GIVEN пользователь удаляет позицию из корзины<br>WHEN пользователь удаляет все кол-во позиции из корзины (счетчик кол-ва = 0)<br>THEN позиция полностью удаляется из корзины<br> |


| №     | User Strory                                                                                  | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ----- | -------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| US 06 | Я как клиент<br>ХОЧУ выбрать способ получения заказа<br>ЧТОБЫ забрать заказ удобным способом | 1\. Сценарий выбора подачи<br>GIVEN пользователь выбирает способ подачи<br>WHEN пользователь выбирает <Способ подачи><br>THEN система отображает <Место выдачи><br><br>2\. Сценарий ограничения на получение заказа для определенных позиций из списка <Только в ресторане><br>GIVEN Система ограничивает получение заказа для позиций из списка <Только в ресторане><br>WHEN пользователь добавил в корзину позиции из списка <Только в ресторане> и переходит на вкладку выбора получения заказа<br>THEN система отражает только один возможный способ подачи «в ресторане» |


| Способ подачи | Место выдачи | Только в ресторане    |
| ------------- | ------------ | --------------------- |
| с собой       | Касса  №1    | XXL ICE CREAM         |
| в ресторане   | Касса  №2    | SUPER MEGA BURGER 420 |


| №     | User Strory                                                                                | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ----- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| US 07 | Я как клиент<br>ХОЧУ выбрать способ оплаты заказа<br>ЧТОБЫ оплатить заказ удобным способом | 1\. Сценарий выбора оплаты<br>GIVEN пользователь выбирает способ оплаты<br>WHEN пользователь переходит на страницу оплаты заказа<br>THEN система отображает <Способы оплаты><br>AND предлагает произвести <операции над баллами><br><br>2\. Сценарий выбора оплаты «картой»<br>GIVEN пользователь выбирает способ оплаты «картой»<br>WHEN пользователь выбирает способ оплаты «картой»<br>THEN система отображает необходимые поля ввода (ФИО, Номер карты, CVV)<br>AND определяет <Тип карты><br><br>3\. Сценарий выбора оплаты «наличными»<br>GIVEN пользователь выбирает способ оплаты «наличными»<br>WHEN пользователь выбирает способ оплаты «наличными»<br>THEN система отображает свободную <Касса для оплаты> для внесения средств |


| Способы оплаты | Тип карты         | Касса для оплаты | Операции над баллами |
| -------------- | ----------------- | ---------------- | -------------------- |
| картой         | VISA / MASTERCARD | Касса №1         | Списать              |
| наличными      | Мир               | Касса №2         | Начислить            |


| №     | User Strory                                                                                                                 | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ----- | --------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 08 | Я как клиент<br>ХОЧУ зарегистрироваться в программе лояльности<br>ЧТОБЫ копить и списывать бонусные баллы при оплате заказа | 1\. Сценарий регистрации нового пользователя в программе лояльности<br>GIVEN Пользователь регистрируется в программе лояльности<br>WHEN Пользователь инициирует регистрацию в программе лояльности и вводит почту и номер телефона<br>THEN Система отправляет код верификации на почту и номер телефона пользователю<br>AND отображает окно для ввода кода<br><br>2\. Сценарий регистрации существующего пользователя в системе в программе лояльности<br>GIVEN Существующий пользователь регистрируется в программе лояльности<br>WHEN Существующий пользователь инициирует регистрацию в программе лояльности и вводит почту и номер телефона, которые уже есть в системе<br>THEN система отражает сообщение о том, что пользователь уже зарегистрирован<br>AND предлагает сбросить пароль |

| №     | User Strory                                                                     | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ----- | ------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 09 | Я как клиент<br>ХОЧУ обратиться к менеджеру<br>ЧТОБЫ получить ответы на вопросы | 1\. Сценарий создания заявки менеджеру<br>GIVEN Пользователь создает заявку менеджеру<br>WHEN Пользователь инициирует создания заявки менеджеру<br>THEN Система предлагает выбрать <категории обращения><br><br>2\. Сценарий отправки заявки менеджеру<br>GIVEN Пользователь отправил заявку менеджеру<br>WHEN Пользователь отправляет заявку менеджеру<br>THEN система отражает отобразить номер обращения и примерное время ответа менеджера |

| категории обращения |
| ------------------- |
| Вопрос по оплате    |
| Вопрос по заказу    |
| Другое              |

| №     | User Strory                                                      | Сценарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ----- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| US 10 | Я как клиент<br>ХОЧУ отменить заказ<br>ЧТОБЫ вернуть свои деньги | 1\. Сценарий создания заявки на возврат<br>GIVEN Пользователь создает заявку на возврат<br>WHEN Пользователь инициирует создания заявки на возврат<br>THEN Система предлагает выбрать <причины возврата><br>AND подробно описать ситуацию<br><br>2\. Сценарий успешного возврата средств<br>GIVEN Пользователь получает успешный возврат средств<br>WHEN Пользователь отправляет заявку на возврат<br>THEN Система отображает уведомление об успешном возврате и сроки возврата средств<br><br>3\. Сценарий неудачного возврата средств<br>GIVEN Пользователь не удается оформить возврат средств<br>WHEN Пользователь отправляет заявку на возврат<br>THEN Система отображает уведомление об отказе и указывает причину отказа |

| причины возврата       |
| ---------------------- |
| Перепутали заказ       |
| Не получил заказ       |
| Что-то не так с блюдом |


 **Проектирование ресурсной модели Open API**
 <a name="Open"></a>
 
 - [Спецификация](https://app.swaggerhub.com/apis/DenisMatveev/order/1.0.0-oas3)

**Контракт метода POST /orders/{orderId}/repeat:**

 | Краткое описание        | Повторение заказа                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Тип запроса             | post                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Адрес                   | /orders/{orderId}/repeat                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Структура запроса       | Заголовки:<br>content: application/json<br>Пример:<br>POST /orders/id8282/repeat                                                                                                                                                                                                                                                                                                                                                                               |
| Структура ответа        | Структура при успехе:<br>При успешном оформлении заказа возвращается:<br>\- order_id: ID заказа (string 250)<br>\- message: сообщение о статусе заказа (string 250)<br>\- time: время оформления заказа (string 250)<br><br>Структура при ошибке:<br>\- HTTP-код ответа integer<br>\- краткое описание причины ошибки - string(250)<br>\- пример:<br><br>{<br>"code": 400,<br>"message":<br>"Неверный запрос, например, неполные или некорректные данные"<br>} |
| Список возможных ошибок | \- 400 : Неверный запрос, например, неполные или некорректные данные<br>\- 401: Пользователь не авторизован<br>\- 403: Пользователь не имеет права на оформление заказа<br>\- 404: Заказ не найден<br>\- 500: Внутренняя ошибка сервера                                                                                                                                                                                                                        |

```json
---
openapi: 3.0.0
info:
  title: Dot Eats
  description: API для заказа блюд через приложение
  version: 1.0.0-oas3
servers:
- url: https://virtserver.swaggerhub.com/cottoffeus/Dot_Eats/1
  description: SwaggerHub API Auto Mocking
paths:
  /auth/login:
    post:
      tags:
      - Технические методы
      summary: Аутентификация пользователя
      description: "Позволяет пользователю войти в систему, используя логин и пароль."
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/auth_login_body'
        required: true
      responses:
        "200":
          description: Успешная аутентификация
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_200'
        "401":
          description: Неверные учетные данные
        "500":
          description: Внутренняя ошибка сервера
  /dishes:
    get:
      tags:
      - Просмотр блюд
      summary: Получение списка блюд
      parameters:
      - name: cusine
        in: query
        description: Фильтр по типу кухни
        required: false
        style: form
        explode: true
        schema:
          type: string
          enum:
          - russian
          - italian
          - georgian
          - asian
      - name: category
        in: query
        description: Фильтр по категории блюда
        required: false
        style: form
        explode: true
        schema:
          type: string
          enum:
          - starter
          - mainCourse
          - dessert
          - soup
          - salad
          - sideDish
          - beverage
      - name: raiting
        in: query
        description: Фильтр по рейтингу блюда
        required: false
        style: form
        explode: true
        schema:
          type: string
          enum:
          - Превосходно
          - Выше Ожидаемого
          - Удовлетворительно
          - Слабо
          - Отвратительно
          - Тролль
      - name: price_min
        in: query
        description: Минимальная цена блюда
        required: false
        style: form
        explode: true
        schema:
          type: number
      - name: price_max
        in: query
        description: Максимальная цена блюда
        required: false
        style: form
        explode: true
        schema:
          type: number
      - name: page
        in: query
        description: Номер страницы для пагинации
        required: false
        style: form
        explode: true
        schema:
          type: integer
          default: 1
      - name: pageSize
        in: query
        description: Количество блюд на странице
        required: false
        style: form
        explode: true
        schema:
          type: integer
          default: 10
      responses:
        "200":
          description: Список блюд
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_200_1'
      security:
      - bearerAuth: []
  /dishes/{dishId}:
    get:
      tags:
      - Просмотр блюд
      summary: Получение деталей блюда
      parameters:
      - name: dishId
        in: path
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "200":
          description: Детали блюда
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DishExtended'
      security:
      - bearerAuth: []
  /cart/items:
    get:
      tags:
      - Работа с заказом и корзиной
      summary: Получение товаров в корзине
      description: "Возвращает список товаров, находящихся в корзине пользователя."
      operationId: getCartItems
      responses:
        "200":
          description: Список товаров в корзине
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CartItemsResponse'
        "401":
          description: "Неавторизован, пользователь не аутентифицирован"
        "404":
          description: Корзина не найдена
        "500":
          description: Внутренняя ошибка сервера
    post:
      tags:
      - Работа с заказом и корзиной
      summary: Добавление блюда в корзину
      description: Добавляет указанное блюдо в корзину пользователя.
      operationId: addItemToCart
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddItemRequest'
        required: true
      responses:
        "201":
          description: Блюдо успешно добавлено в корзину
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddItemResponse'
        "400":
          description: "Неверный запрос, например, отсутствует идентификатор блюда или количество"
        "401":
          description: Пользователь не авторизован
        "500":
          description: Внутренняя ошибка сервера
  /cart/items/{itemId}:
    patch:
      tags:
      - Работа с заказом и корзиной
      summary: Редактирование блюда в корзине
      description: Обновляет количество указанного блюда в корзине пользователя.
      operationId: updateCartItem
      parameters:
      - name: itemId
        in: path
        description: Уникальный идентификатор блюда
        required: true
        style: simple
        explode: false
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateItemRequest'
        required: true
      responses:
        "200":
          description: Информация о блюде успешно обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateItemResponse'
        "400":
          description: "Неверный запрос, например, отсутствует количество"
        "401":
          description: Пользователь не авторизован
        "404":
          description: Блюдо не найдено в корзине
        "500":
          description: Внутренняя ошибка сервера
  /cart/checkout:
    post:
      tags:
      - Работа с заказом и корзиной
      summary: Оформление заказа
      description: Оформляет заказ на основе текущего содержимого корзины пользователя.
      operationId: checkoutCart
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
        required: true
      responses:
        "200":
          description: Заказ успешно оформлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckoutResponse'
        "400":
          description: "Неверный запрос, например, неполные или некорректные данные"
        "401":
          description: Пользователь не авторизован
        "403":
          description: Пользователь не имеет права на оформление заказа
        "404":
          description: Корзина не найдена
        "500":
          description: Внутренняя ошибка сервера
      security:
      - bearerAuth: []
  /orders/{orderId}/payment:
    post:
      tags:
      - Работа с заказом и корзиной
      summary: Инициация оплаты заказа
      description: Инициирует процесс оплаты для указанного заказа и возвращает ссылку для перенаправления на платежный шлюз.
      operationId: initiatePayment
      parameters:
      - name: orderId
        in: path
        description: Уникальный идентификатор заказа
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "303":
          description: Перенаправление на платежный шлюз
          headers:
            Location:
              description: URL платежного шлюза
              style: simple
              explode: false
              schema:
                type: string
              example: https://help.reg.ru/support/hosting/redirekty/kak-sdelat-redirekt-na-html
        "400":
          description: "Неверный запрос, например, неполные или некорректные данные"
        "401":
          description: Пользователь не авторизован
        "403":
          description: Пользователь не имеет права на оплату данного заказа
        "404":
          description: Заказ не найден
        "500":
          description: Внутренняя ошибка сервера
      security:
      - bearerAuth: []
  /orders/{orderID}/status:
    get:
      tags:
      - Получение статуса заказа
      parameters:
      - name: orderID
        in: path
        description: Уникальный идентификатор заказа
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "200":
          description: Статус получен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_200_2'
        "400":
          description: "Неверный запрос, например, неполные или некорректные данные"
        "401":
          description: Пользователь не авторизован
        "403":
          description: Пользователь не имеет права на оформление заказа
        "404":
          description: Корзина не найдена
        "500":
          description: Внутренняя ошибка сервера
  /dishes/{dishId}/reviews:
    post:
      tags:
      - Добавление отзыва о заказанном блюде
      parameters:
      - name: dishId
        in: path
        description: Уникальный идентификатор блюда
        required: true
        style: simple
        explode: false
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/dishId_reviews_body'
        required: true
      responses:
        "200":
          description: Отзыв успешно добавлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddReviews'
        "400":
          description: "Неверный запрос, например, отсутствует идентификатор блюда или количество"
        "401":
          description: Пользователь не авторизован
        "500":
          description: Внутренняя ошибка сервера
  /orders/{orderId}/repeat:
    post:
      tags:
      - Работа с заказом и корзиной
      summary: Повторение заказа
      operationId: repeatOrder
      parameters:
      - name: orderId
        in: path
        description: Уникальный идентификатор заказа
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "200":
          description: Заказ успешно оформлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckoutResponse'
        "400":
          description: "Неверный запрос, например, неполные или некорректные данные"
        "401":
          description: Пользователь не авторизован
        "403":
          description: Пользователь не имеет права на оформление заказа
        "404":
          description: Заказ не найден
        "500":
          description: Внутренняя ошибка сервера
      security:
      - bearerAuth: []
  /orders:
    get:
      tags:
      - Работа с заказом и корзиной
      summary: Метод получения истории заказов
      description: "Метод предназначен для получения списка заказов, сохраненных в БД."
      operationId: getOrders
      responses:
        "200":
          description: Список заказов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CheckoutResponse'
components:
  schemas:
    AddItemRequest:
      required:
      - itemId
      - quantity
      type: object
      properties:
        itemId:
          type: string
          description: Уникальный идентификатор блюда
        quantity:
          type: integer
          description: Количество добавляемых блюд
    AddItemResponse:
      type: object
      properties:
        message:
          type: string
          description: Сообщение о результате добавления
        cartTotal:
          type: integer
          description: Общее количество блюд в корзине
    CartItemsResponse:
      type: object
      properties:
        userId:
          type: string
          description: Уникальный идентификатор пользователя
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'
        totalPrice:
          type: number
          description: Общая стоимость всех товаров в корзине
          format: float
    CartItem:
      type: object
      properties:
        itemId:
          type: string
          description: Уникальный идентификатор товара
        name:
          type: string
          description: Название товара
        quantity:
          type: integer
          description: Количество товара в корзине
        price:
          type: number
          description: Цена за единицу товара
          format: float
    UpdateItemRequest:
      required:
      - quantity
      type: object
      properties:
        quantity:
          type: integer
          description: Новое количество блюда
    UpdateItemResponse:
      type: object
      properties:
        message:
          type: string
          description: Сообщение о результате обновления
        updatedItem:
          $ref: '#/components/schemas/CartItem'
    CheckoutRequest:
      type: object
      properties:
        address:
          type: string
          description: Адрес доставки
        paymentMethod:
          type: string
          description: Способ оплаты
          enum:
          - card
          - ewallet
          - sbp
          - tpay
          - spay
          - cash
    CheckoutResponse:
      type: object
      properties:
        orderId:
          type: string
          description: Уникальный идентификатор заказа
        message:
          type: string
          description: Сообщение о статусе заказа
        time:
          type: string
          description: Время заказа с точностью до миллисекунд
          example: 1996-12-20T00:39:57.870Z
    Dish:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        imageLink:
          type: string
          format: url
          example: https://static.wikia.nocookie.net/harrypotter/images/c/c5/Pumpkin_Juice_WWHP.jpg/revision/latest/scale-to-width-down/1000?cb=20110529053444
    DishExtended:
      allOf:
      - $ref: '#/components/schemas/Dish'
      - type: object
        properties:
          description:
            type: string
          cusine:
            type: string
            enum:
            - russian
            - italian
            - georgian
            - asian
          category:
            type: string
            enum:
            - starter
            - mainCourse
            - dessert
            - soup
            - salad
            - sideDish
            - beverage
          raiting:
            type: string
            enum:
            - Превосходно
            - Выше Ожидаемого
            - Удовлетворительно
            - Слабо
            - Отвратительно
            - Тролль
          price:
            type: number
    AddReviews:
      required:
      - reviewId
      - status
      - textReview
      type: object
      properties:
        textReview:
          type: string
        reviewId:
          type: string
        status:
          type: string
    auth_login_body:
      required:
      - password
      - username
      type: object
      properties:
        username:
          type: string
          description: Имя пользователя
        password:
          type: string
          description: Пароль пользователя
          format: password
    inline_response_200:
      type: object
      properties:
        token:
          type: string
          description: Токен доступа
          format: JWT
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkhhcnJ5IFBvdHRlciIsImlhdCI6MTUxNjIzOTAyMn0.Jkr1iBrO9-cr7uZRYhvE8BuSXIfuPnQWuZBNBE60t14
    inline_response_200_1:
      type: object
      properties:
        total:
          type: integer
          description: "Общее количество блюд, соответствующих фильтрам"
        dishes:
          type: array
          items:
            $ref: '#/components/schemas/Dish'
        page:
          type: integer
          description: Текущая страница
        pageSize:
          type: integer
          description: Количество блюд на странице
    inline_response_200_2:
      type: object
      properties:
        status:
          type: string
    dishId_reviews_body:
      type: object
      properties:
        textReview:
          type: string
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

```
